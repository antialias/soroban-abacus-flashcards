// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 89 → 97 1`] = `
{
  "fullDecomposition": "89 + 8 = 89 + (10 - 2) = 97",
  "isMeaningfulDecomposition": true,
  "startValue": 89,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 99,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 97,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 97,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 98 → 105 1`] = `
{
  "fullDecomposition": "98 + 7 = 98 + (100 - 90 - 3) = 105",
  "isMeaningfulDecomposition": true,
  "startValue": 98,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 198,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 108,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 105,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 105,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 99 → 107 1`] = `
{
  "fullDecomposition": "99 + 8 = 99 + (100 - 90 - 2) = 107",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 107,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 107,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 189 → 197 1`] = `
{
  "fullDecomposition": "189 + 8 = 189 + (10 - 2) = 197",
  "isMeaningfulDecomposition": true,
  "startValue": 189,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 197,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 197,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 198 → 205 1`] = `
{
  "fullDecomposition": "198 + 7 = 198 + (100 - 90 - 3) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 198,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 298,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 208,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 199 → 207 1`] = `
{
  "fullDecomposition": "199 + 8 = 199 + (100 - 90 - 2) = 207",
  "isMeaningfulDecomposition": true,
  "startValue": 199,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 299,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 209,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 207,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 207,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 289 → 297 1`] = `
{
  "fullDecomposition": "289 + 8 = 289 + (10 - 2) = 297",
  "isMeaningfulDecomposition": true,
  "startValue": 289,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 299,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 297,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 297,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 298 → 305 1`] = `
{
  "fullDecomposition": "298 + 7 = 298 + (100 - 90 - 3) = 305",
  "isMeaningfulDecomposition": true,
  "startValue": 298,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 398,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 308,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 305,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 305,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 299 → 307 1`] = `
{
  "fullDecomposition": "299 + 8 = 299 + (100 - 90 - 2) = 307",
  "isMeaningfulDecomposition": true,
  "startValue": 299,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 399,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 309,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 307,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 307,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 389 → 397 1`] = `
{
  "fullDecomposition": "389 + 8 = 389 + (10 - 2) = 397",
  "isMeaningfulDecomposition": true,
  "startValue": 389,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 399,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 397,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 397,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 398 → 405 1`] = `
{
  "fullDecomposition": "398 + 7 = 398 + (100 - 90 - 3) = 405",
  "isMeaningfulDecomposition": true,
  "startValue": 398,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 498,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 408,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 405,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 405,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 399 → 407 1`] = `
{
  "fullDecomposition": "399 + 8 = 399 + (100 - 90 - 2) = 407",
  "isMeaningfulDecomposition": true,
  "startValue": 399,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 499,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 409,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 407,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 407,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 499 → 507 1`] = `
{
  "fullDecomposition": "499 + 8 = 499 + (100 - 90 - 2) = 507",
  "isMeaningfulDecomposition": true,
  "startValue": 499,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 599,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 509,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 507,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 507,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 599 → 607 1`] = `
{
  "fullDecomposition": "599 + 8 = 599 + (100 - 90 - 2) = 607",
  "isMeaningfulDecomposition": true,
  "startValue": 599,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 699,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 609,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 607,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 607,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 699 → 707 1`] = `
{
  "fullDecomposition": "699 + 8 = 699 + (100 - 90 - 2) = 707",
  "isMeaningfulDecomposition": true,
  "startValue": 699,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 799,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 709,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 707,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 707,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 799 → 807 1`] = `
{
  "fullDecomposition": "799 + 8 = 799 + (100 - 90 - 2) = 807",
  "isMeaningfulDecomposition": true,
  "startValue": 799,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 899,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 809,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 807,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 807,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 979 → 986 1`] = `
{
  "fullDecomposition": "979 + 7 = 979 + (10 - 3) = 986",
  "isMeaningfulDecomposition": true,
  "startValue": 979,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 986,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 986,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 989 → 996 1`] = `
{
  "fullDecomposition": "989 + 7 = 989 + (10 - 3) = 996",
  "isMeaningfulDecomposition": true,
  "startValue": 989,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 999,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 996,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 996,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 999 → 1007 1`] = `
{
  "fullDecomposition": "999 + 8 = 999 + (1000 - 900 - 90 - 2) = 1007",
  "isMeaningfulDecomposition": true,
  "startValue": 999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1007,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 1899 → 1907 1`] = `
{
  "fullDecomposition": "1899 + 8 = 1899 + (100 - 90 - 2) = 1907",
  "isMeaningfulDecomposition": true,
  "startValue": 1899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 1979 → 1986 1`] = `
{
  "fullDecomposition": "1979 + 7 = 1979 + (10 - 3) = 1986",
  "isMeaningfulDecomposition": true,
  "startValue": 1979,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1986,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1986,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 1989 → 1996 1`] = `
{
  "fullDecomposition": "1989 + 7 = 1989 + (10 - 3) = 1996",
  "isMeaningfulDecomposition": true,
  "startValue": 1989,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1996,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1996,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 1999 → 2007 1`] = `
{
  "fullDecomposition": "1999 + 8 = 1999 + (1000 - 900 - 90 - 2) = 2007",
  "isMeaningfulDecomposition": true,
  "startValue": 1999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2007,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 2899 → 2907 1`] = `
{
  "fullDecomposition": "2899 + 8 = 2899 + (100 - 90 - 2) = 2907",
  "isMeaningfulDecomposition": true,
  "startValue": 2899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 2979 → 2986 1`] = `
{
  "fullDecomposition": "2979 + 7 = 2979 + (10 - 3) = 2986",
  "isMeaningfulDecomposition": true,
  "startValue": 2979,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2986,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2986,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 2989 → 2996 1`] = `
{
  "fullDecomposition": "2989 + 7 = 2989 + (10 - 3) = 2996",
  "isMeaningfulDecomposition": true,
  "startValue": 2989,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2999,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2996,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2996,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 2999 → 3007 1`] = `
{
  "fullDecomposition": "2999 + 8 = 2999 + (1000 - 900 - 90 - 2) = 3007",
  "isMeaningfulDecomposition": true,
  "startValue": 2999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3007,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 9899 → 9907 1`] = `
{
  "fullDecomposition": "9899 + 8 = 9899 + (100 - 90 - 2) = 9907",
  "isMeaningfulDecomposition": true,
  "startValue": 9899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 9999 → 10007 1`] = `
{
  "fullDecomposition": "9999 + 8 = 9999 + (10000 - 9000 - 900 - 90 - 2) = 10007",
  "isMeaningfulDecomposition": true,
  "startValue": 9999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 46,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10007,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 12899 → 12907 1`] = `
{
  "fullDecomposition": "12899 + 8 = 12899 + (100 - 90 - 2) = 12907",
  "isMeaningfulDecomposition": true,
  "startValue": 12899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 19899 → 19907 1`] = `
{
  "fullDecomposition": "19899 + 8 = 19899 + (100 - 90 - 2) = 19907",
  "isMeaningfulDecomposition": true,
  "startValue": 19899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 19907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Cascading Complement Cases > should handle cascading complement: 19999 → 20007 1`] = `
{
  "fullDecomposition": "19999 + 8 = 19999 + (10000 - 9000 - 900 - 90 - 2) = 20007",
  "isMeaningfulDecomposition": true,
  "startValue": 19999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 44,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 48,
        "startIndex": 47,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20007,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 1 1`] = `
{
  "fullDecomposition": "0 + 1 = 0 + 1 = 1",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 2 1`] = `
{
  "fullDecomposition": "0 + 2 = 0 + 2 = 2",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 3 1`] = `
{
  "fullDecomposition": "0 + 3 = 0 + 3 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 4 1`] = `
{
  "fullDecomposition": "0 + 4 = 0 + 4 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 5 1`] = `
{
  "fullDecomposition": "0 + 5 = 0 + 5 = 5",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 10 1`] = `
{
  "fullDecomposition": "0 + 10 = 0 + 10 = 10",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 20 1`] = `
{
  "fullDecomposition": "0 + 20 = 0 + 20 = 20",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 30 1`] = `
{
  "fullDecomposition": "0 + 30 = 0 + 30 = 30",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 30,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 30,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 40 1`] = `
{
  "fullDecomposition": "0 + 40 = 0 + 40 = 40",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 40,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 40,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 50 1`] = `
{
  "fullDecomposition": "0 + 50 = 0 + 50 = 50",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 50,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 100 1`] = `
{
  "fullDecomposition": "0 + 100 = 0 + 100 = 100",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 200 1`] = `
{
  "fullDecomposition": "0 + 200 = 0 + 200 = 200",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "200",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 300 1`] = `
{
  "fullDecomposition": "0 + 300 = 0 + 300 = 300",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 300,
      "isValid": true,
      "mathematicalTerm": "300",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 300,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 1 → 2 1`] = `
{
  "fullDecomposition": "1 + 1 = 1 + 1 = 2",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 1 → 3 1`] = `
{
  "fullDecomposition": "1 + 2 = 1 + 2 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 1 → 4 1`] = `
{
  "fullDecomposition": "1 + 3 = 1 + 3 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 2 → 3 1`] = `
{
  "fullDecomposition": "2 + 1 = 2 + 1 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 2 → 4 1`] = `
{
  "fullDecomposition": "2 + 2 = 2 + 2 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 3 → 4 1`] = `
{
  "fullDecomposition": "3 + 1 = 3 + 1 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 5 → 6 1`] = `
{
  "fullDecomposition": "5 + 1 = 5 + 1 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 5 → 7 1`] = `
{
  "fullDecomposition": "5 + 2 = 5 + 2 = 7",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 5 → 8 1`] = `
{
  "fullDecomposition": "5 + 3 = 5 + 3 = 8",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 8,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 5 → 9 1`] = `
{
  "fullDecomposition": "5 + 4 = 5 + 4 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 10 → 20 1`] = `
{
  "fullDecomposition": "10 + 10 = 10 + 10 = 20",
  "isMeaningfulDecomposition": false,
  "startValue": 10,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 11 → 22 1`] = `
{
  "fullDecomposition": "11 + 11 = 11 + 10 + 1 = 22",
  "isMeaningfulDecomposition": true,
  "startValue": 11,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 21,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 22,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 22,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 20 → 30 1`] = `
{
  "fullDecomposition": "20 + 10 = 20 + 10 = 30",
  "isMeaningfulDecomposition": false,
  "startValue": 20,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 30,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 30,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 22 → 33 1`] = `
{
  "fullDecomposition": "22 + 11 = 22 + 10 + 1 = 33",
  "isMeaningfulDecomposition": true,
  "startValue": 22,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 32,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 33,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 33,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 30 → 40 1`] = `
{
  "fullDecomposition": "30 + 10 = 30 + 10 = 40",
  "isMeaningfulDecomposition": false,
  "startValue": 30,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 40,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 40,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 40 → 50 1`] = `
{
  "fullDecomposition": "40 + 10 = 40 + (50 - 40) = 50",
  "isMeaningfulDecomposition": true,
  "startValue": 40,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 90,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 4 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50,
      "isValid": true,
      "mathematicalTerm": "-40",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 50,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 100 → 200 1`] = `
{
  "fullDecomposition": "100 + 100 = 100 + 100 = 200",
  "isMeaningfulDecomposition": false,
  "startValue": 100,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Direct Entry Cases (No Complements) > should handle direct entry: 123 → 234 1`] = `
{
  "fullDecomposition": "123 + 111 = 123 + 100 + 10 + 1 = 234",
  "isMeaningfulDecomposition": true,
  "startValue": 123,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 223,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 233,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 234,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 0 → 0 1`] = `
{
  "fullDecomposition": "0 + 0 = 0",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [],
  "targetValue": 0,
  "totalSteps": 0,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 0 → 1 1`] = `
{
  "fullDecomposition": "0 + 1 = 0 + 1 = 1",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 0 → 9 1`] = `
{
  "fullDecomposition": "0 + 9 = 0 + 5 + 4 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 1 → 2 1`] = `
{
  "fullDecomposition": "1 + 1 = 1 + 1 = 2",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 5 → 5 1`] = `
{
  "fullDecomposition": "5 + 0 = 5",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [],
  "targetValue": 5,
  "totalSteps": 0,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 9 → 10 1`] = `
{
  "fullDecomposition": "9 + 1 = 9 + (10 - 9) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 9 → 10 2`] = `
{
  "fullDecomposition": "9 + 1 = 9 + (10 - 9) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 9 → 18 1`] = `
{
  "fullDecomposition": "9 + 9 = 9 + (10 - 1) = 18",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 18,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 10 → 10 1`] = `
{
  "fullDecomposition": "10 + 0 = 10",
  "isMeaningfulDecomposition": false,
  "startValue": 10,
  "steps": [],
  "targetValue": 10,
  "totalSteps": 0,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 10 → 19 1`] = `
{
  "fullDecomposition": "10 + 9 = 10 + 5 + 4 = 19",
  "isMeaningfulDecomposition": false,
  "startValue": 10,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 19,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 19 → 20 1`] = `
{
  "fullDecomposition": "19 + 1 = 19 + (10 - 9) = 20",
  "isMeaningfulDecomposition": true,
  "startValue": 19,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 90 → 99 1`] = `
{
  "fullDecomposition": "90 + 9 = 90 + 5 + 4 = 99",
  "isMeaningfulDecomposition": false,
  "startValue": 90,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 95,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 99,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 99,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 99 → 100 1`] = `
{
  "fullDecomposition": "99 + 1 = 99 + (100 - 90 - 9) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 99 → 100 2`] = `
{
  "fullDecomposition": "99 + 1 = 99 + (100 - 90 - 9) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 99 → 108 1`] = `
{
  "fullDecomposition": "99 + 9 = 99 + (100 - 90 - 1) = 108",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 108,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 108,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 123 → 123 1`] = `
{
  "fullDecomposition": "123 + 0 = 123",
  "isMeaningfulDecomposition": false,
  "startValue": 123,
  "steps": [],
  "targetValue": 123,
  "totalSteps": 0,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 199 → 200 1`] = `
{
  "fullDecomposition": "199 + 1 = 199 + (100 - 90 - 9) = 200",
  "isMeaningfulDecomposition": true,
  "startValue": 199,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 299,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 209,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 900 → 909 1`] = `
{
  "fullDecomposition": "900 + 9 = 900 + 5 + 4 = 909",
  "isMeaningfulDecomposition": false,
  "startValue": 900,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 905,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 909,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 909,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 999 → 1000 1`] = `
{
  "fullDecomposition": "999 + 1 = 999 + (1000 - 900 - 90 - 9) = 1000",
  "isMeaningfulDecomposition": true,
  "startValue": 999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 999 → 1000 2`] = `
{
  "fullDecomposition": "999 + 1 = 999 + (1000 - 900 - 90 - 9) = 1000",
  "isMeaningfulDecomposition": true,
  "startValue": 999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 999 → 1008 1`] = `
{
  "fullDecomposition": "999 + 9 = 999 + (1000 - 900 - 90 - 1) = 1008",
  "isMeaningfulDecomposition": true,
  "startValue": 999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1008,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 1111 → 1123 1`] = `
{
  "fullDecomposition": "1111 + 12 = 1111 + 10 + 2 = 1123",
  "isMeaningfulDecomposition": true,
  "startValue": 1111,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1121,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1123,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1123,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 1357 → 1369 1`] = `
{
  "fullDecomposition": "1357 + 12 = 1357 + 10 + 2 = 1369",
  "isMeaningfulDecomposition": true,
  "startValue": 1357,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1367,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1369,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1369,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 1999 → 2000 1`] = `
{
  "fullDecomposition": "1999 + 1 = 1999 + (1000 - 900 - 90 - 9) = 2000",
  "isMeaningfulDecomposition": true,
  "startValue": 1999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2000,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 2222 → 2234 1`] = `
{
  "fullDecomposition": "2222 + 12 = 2222 + 10 + 2 = 2234",
  "isMeaningfulDecomposition": true,
  "startValue": 2222,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2232,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2234,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2234,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 2468 → 2479 1`] = `
{
  "fullDecomposition": "2468 + 11 = 2468 + 10 + 1 = 2479",
  "isMeaningfulDecomposition": true,
  "startValue": 2468,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2478,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2479,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2479,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 3333 → 3345 1`] = `
{
  "fullDecomposition": "3333 + 12 = 3333 + 10 + (5 - 3) = 3345",
  "isMeaningfulDecomposition": true,
  "startValue": 3333,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3343,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3348,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3345,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3345,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 9999 → 10000 1`] = `
{
  "fullDecomposition": "9999 + 1 = 9999 + (10000 - 9000 - 900 - 90 - 9) = 10000",
  "isMeaningfulDecomposition": true,
  "startValue": 9999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 46,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10000,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 9999 → 10008 1`] = `
{
  "fullDecomposition": "9999 + 9 = 9999 + (10000 - 9000 - 900 - 90 - 1) = 10008",
  "isMeaningfulDecomposition": true,
  "startValue": 9999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 46,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10008,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 11111 → 11123 1`] = `
{
  "fullDecomposition": "11111 + 12 = 11111 + 10 + 2 = 11123",
  "isMeaningfulDecomposition": true,
  "startValue": 11111,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11121,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11123,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11123,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 13579 → 13591 1`] = `
{
  "fullDecomposition": "13579 + 12 = 13579 + 10 + (10 - 8) = 13591",
  "isMeaningfulDecomposition": true,
  "startValue": 13579,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13589,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13599,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -8",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13591,
      "isValid": true,
      "mathematicalTerm": "-8",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 13591,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 19999 → 20000 1`] = `
{
  "fullDecomposition": "19999 + 1 = 19999 + (10000 - 9000 - 900 - 90 - 9) = 20000",
  "isMeaningfulDecomposition": true,
  "startValue": 19999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 44,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 48,
        "startIndex": 47,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20000,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Edge Cases and Boundary Conditions > should handle edge case: 22222 → 22234 1`] = `
{
  "fullDecomposition": "22222 + 12 = 22222 + 10 + 2 = 22234",
  "isMeaningfulDecomposition": true,
  "startValue": 22222,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 22232,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 22234,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 22234,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 1 → 4 1`] = `
{
  "fullDecomposition": "1 + 3 = 1 + 3 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 1 → 5 1`] = `
{
  "fullDecomposition": "1 + 4 = 1 + (5 - 1) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 1 → 6 1`] = `
{
  "fullDecomposition": "1 + 5 = 1 + 5 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 2 → 5 1`] = `
{
  "fullDecomposition": "2 + 3 = 2 + (5 - 2) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 2 → 6 1`] = `
{
  "fullDecomposition": "2 + 4 = 2 + (5 - 1) = 6",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 2 → 7 1`] = `
{
  "fullDecomposition": "2 + 5 = 2 + 5 = 7",
  "isMeaningfulDecomposition": false,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 3 → 6 1`] = `
{
  "fullDecomposition": "3 + 3 = 3 + (5 - 2) = 6",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 3 → 7 1`] = `
{
  "fullDecomposition": "3 + 4 = 3 + (5 - 1) = 7",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 3 → 8 1`] = `
{
  "fullDecomposition": "3 + 5 = 3 + 5 = 8",
  "isMeaningfulDecomposition": false,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 8,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 4 → 7 1`] = `
{
  "fullDecomposition": "4 + 3 = 4 + (5 - 2) = 7",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 4 → 8 1`] = `
{
  "fullDecomposition": "4 + 4 = 4 + (5 - 1) = 8",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 8,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 4 → 9 1`] = `
{
  "fullDecomposition": "4 + 5 = 4 + 5 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 14 → 17 1`] = `
{
  "fullDecomposition": "14 + 3 = 14 + (5 - 2) = 17",
  "isMeaningfulDecomposition": true,
  "startValue": 14,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 17,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 23 → 26 1`] = `
{
  "fullDecomposition": "23 + 3 = 23 + (5 - 2) = 26",
  "isMeaningfulDecomposition": true,
  "startValue": 23,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 28,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 26,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 26,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 31 → 34 1`] = `
{
  "fullDecomposition": "31 + 3 = 31 + 3 = 34",
  "isMeaningfulDecomposition": false,
  "startValue": 31,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 34,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 40 → 70 1`] = `
{
  "fullDecomposition": "40 + 30 = 40 + (50 - 20) = 70",
  "isMeaningfulDecomposition": true,
  "startValue": 40,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 90,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 70,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 70,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 42 → 45 1`] = `
{
  "fullDecomposition": "42 + 3 = 42 + (5 - 2) = 45",
  "isMeaningfulDecomposition": true,
  "startValue": 42,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 47,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 45,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 54 → 57 1`] = `
{
  "fullDecomposition": "54 + 3 = 54 + (5 - 2) = 57",
  "isMeaningfulDecomposition": true,
  "startValue": 54,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 59,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 57,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 57,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 134 → 137 1`] = `
{
  "fullDecomposition": "134 + 3 = 134 + (5 - 2) = 137",
  "isMeaningfulDecomposition": true,
  "startValue": 134,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 139,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 137,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 137,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 223 → 226 1`] = `
{
  "fullDecomposition": "223 + 3 = 223 + (5 - 2) = 226",
  "isMeaningfulDecomposition": true,
  "startValue": 223,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 228,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 226,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 226,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 314 → 317 1`] = `
{
  "fullDecomposition": "314 + 3 = 314 + (5 - 2) = 317",
  "isMeaningfulDecomposition": true,
  "startValue": 314,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 319,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 317,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 317,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 400 → 700 1`] = `
{
  "fullDecomposition": "400 + 300 = 400 + (500 - 200) = 700",
  "isMeaningfulDecomposition": true,
  "startValue": 400,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 900,
      "isValid": true,
      "mathematicalTerm": "500",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 700,
      "isValid": true,
      "mathematicalTerm": "-200",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 700,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 425 → 428 1`] = `
{
  "fullDecomposition": "425 + 3 = 425 + 3 = 428",
  "isMeaningfulDecomposition": false,
  "startValue": 425,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 428,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 428,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 1234 → 1237 1`] = `
{
  "fullDecomposition": "1234 + 3 = 1234 + (5 - 2) = 1237",
  "isMeaningfulDecomposition": true,
  "startValue": 1234,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1239,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1237,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1237,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 1400 → 1700 1`] = `
{
  "fullDecomposition": "1400 + 300 = 1400 + (500 - 200) = 1700",
  "isMeaningfulDecomposition": true,
  "startValue": 1400,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1900,
      "isValid": true,
      "mathematicalTerm": "500",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1700,
      "isValid": true,
      "mathematicalTerm": "-200",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1700,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 2341 → 2344 1`] = `
{
  "fullDecomposition": "2341 + 3 = 2341 + 3 = 2344",
  "isMeaningfulDecomposition": false,
  "startValue": 2341,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2344,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2344,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 3452 → 3455 1`] = `
{
  "fullDecomposition": "3452 + 3 = 3452 + (5 - 2) = 3455",
  "isMeaningfulDecomposition": true,
  "startValue": 3452,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3457,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3455,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3455,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Five-Complement Cases > should handle five-complement: 24000 → 27000 1`] = `
{
  "fullDecomposition": "24000 + 3000 = 24000 + (5000 - 2000) = 27000",
  "isMeaningfulDecomposition": true,
  "startValue": 24000,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29000,
      "isValid": true,
      "mathematicalTerm": "5000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from thousands",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 27000,
      "isValid": true,
      "mathematicalTerm": "-2000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 27000,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 12345 → 12378 1`] = `
{
  "fullDecomposition": "12345 + 33 = 12345 + (50 - 20) + 3 = 12378",
  "isMeaningfulDecomposition": true,
  "startValue": 12345,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12395,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12375,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12378,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12378,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 23456 → 23489 1`] = `
{
  "fullDecomposition": "23456 + 33 = 23456 + 30 + 3 = 23489",
  "isMeaningfulDecomposition": true,
  "startValue": 23456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 23486,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 23489,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 23489,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 34567 → 34599 1`] = `
{
  "fullDecomposition": "34567 + 32 = 34567 + 30 + 2 = 34599",
  "isMeaningfulDecomposition": true,
  "startValue": 34567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34599,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 34599,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 45678 → 45711 1`] = `
{
  "fullDecomposition": "45678 + 33 = 45678 + (100 - 70) + (10 - 7) = 45711",
  "isMeaningfulDecomposition": true,
  "startValue": 45678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45708,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45718,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45711,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 45711,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 56789 → 56822 1`] = `
{
  "fullDecomposition": "56789 + 33 = 56789 + (100 - 70) + (10 - 7) = 56822",
  "isMeaningfulDecomposition": true,
  "startValue": 56789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56822,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 56822,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 67890 → 67923 1`] = `
{
  "fullDecomposition": "67890 + 33 = 67890 + (100 - 70) + 3 = 67923",
  "isMeaningfulDecomposition": true,
  "startValue": 67890,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67990,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67920,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67923,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 67923,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 123456 → 123489 1`] = `
{
  "fullDecomposition": "123456 + 33 = 123456 + 30 + 3 = 123489",
  "isMeaningfulDecomposition": true,
  "startValue": 123456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123486,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123489,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 123489,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 234567 → 234599 1`] = `
{
  "fullDecomposition": "234567 + 32 = 234567 + 30 + 2 = 234599",
  "isMeaningfulDecomposition": true,
  "startValue": 234567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234599,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 234599,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 345678 → 345711 1`] = `
{
  "fullDecomposition": "345678 + 33 = 345678 + (100 - 70) + (10 - 7) = 345711",
  "isMeaningfulDecomposition": true,
  "startValue": 345678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345708,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345718,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345711,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 345711,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 456789 → 456822 1`] = `
{
  "fullDecomposition": "456789 + 33 = 456789 + (100 - 70) + (10 - 7) = 456822",
  "isMeaningfulDecomposition": true,
  "startValue": 456789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456822,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 456822,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 567890 → 567923 1`] = `
{
  "fullDecomposition": "567890 + 33 = 567890 + (100 - 70) + 3 = 567923",
  "isMeaningfulDecomposition": true,
  "startValue": 567890,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567990,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567920,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567923,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 567923,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 678901 → 678934 1`] = `
{
  "fullDecomposition": "678901 + 33 = 678901 + 30 + 3 = 678934",
  "isMeaningfulDecomposition": true,
  "startValue": 678901,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 678931,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 678934,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 678934,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 1234567 → 1234599 1`] = `
{
  "fullDecomposition": "1234567 + 32 = 1234567 + 30 + 2 = 1234599",
  "isMeaningfulDecomposition": true,
  "startValue": 1234567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1234597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1234599,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1234599,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 2345678 → 2345711 1`] = `
{
  "fullDecomposition": "2345678 + 33 = 2345678 + (100 - 70) + (10 - 7) = 2345711",
  "isMeaningfulDecomposition": true,
  "startValue": 2345678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2345778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2345708,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2345718,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2345711,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 45,
        "startIndex": 44,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2345711,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Large Number Operations > should handle large numbers: 3456789 → 3456822 1`] = `
{
  "fullDecomposition": "3456789 + 33 = 3456789 + (100 - 70) + (10 - 7) = 3456822",
  "isMeaningfulDecomposition": true,
  "startValue": 3456789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3456889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3456819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3456829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3456822,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 45,
        "startIndex": 44,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3456822,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 43 → 51 1`] = `
{
  "fullDecomposition": "43 + 8 = 43 + (10 - 2) = 51",
  "isMeaningfulDecomposition": true,
  "startValue": 43,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 53,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 51,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 51,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 134 → 142 1`] = `
{
  "fullDecomposition": "134 + 8 = 134 + (10 - 2) = 142",
  "isMeaningfulDecomposition": true,
  "startValue": 134,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 144,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 142,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 142,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 243 → 251 1`] = `
{
  "fullDecomposition": "243 + 8 = 243 + (10 - 2) = 251",
  "isMeaningfulDecomposition": true,
  "startValue": 243,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 253,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 251,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 251,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 352 → 360 1`] = `
{
  "fullDecomposition": "352 + 8 = 352 + (10 - 2) = 360",
  "isMeaningfulDecomposition": true,
  "startValue": 352,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 362,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 360,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 360,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 1234 → 1279 1`] = `
{
  "fullDecomposition": "1234 + 45 = 1234 + (50 - 10) + 5 = 1279",
  "isMeaningfulDecomposition": true,
  "startValue": 1234,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1284,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1274,
      "isValid": true,
      "mathematicalTerm": "-10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1279,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1279,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 2345 → 2383 1`] = `
{
  "fullDecomposition": "2345 + 38 = 2345 + (50 - 20) + (10 - 2) = 2383",
  "isMeaningfulDecomposition": true,
  "startValue": 2345,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2395,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2375,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2385,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2383,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2383,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 3456 → 3497 1`] = `
{
  "fullDecomposition": "3456 + 41 = 3456 + 40 + 1 = 3497",
  "isMeaningfulDecomposition": true,
  "startValue": 3456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3496,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3497,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3497,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 4567 → 4605 1`] = `
{
  "fullDecomposition": "4567 + 38 = 4567 + 30 + (100 - 90 - 2) = 4605",
  "isMeaningfulDecomposition": true,
  "startValue": 4567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4605,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4605,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 5678 → 5719 1`] = `
{
  "fullDecomposition": "5678 + 41 = 5678 + (100 - 60) + 1 = 5719",
  "isMeaningfulDecomposition": true,
  "startValue": 5678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5718,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5719,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5719,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 6789 → 6827 1`] = `
{
  "fullDecomposition": "6789 + 38 = 6789 + (100 - 70) + (10 - 2) = 6827",
  "isMeaningfulDecomposition": true,
  "startValue": 6789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6827,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 38,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6827,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 12345 → 12389 1`] = `
{
  "fullDecomposition": "12345 + 44 = 12345 + (50 - 10) + 4 = 12389",
  "isMeaningfulDecomposition": true,
  "startValue": 12345,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12395,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12385,
      "isValid": true,
      "mathematicalTerm": "-10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12389,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12389,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 23456 → 23497 1`] = `
{
  "fullDecomposition": "23456 + 41 = 23456 + 40 + 1 = 23497",
  "isMeaningfulDecomposition": true,
  "startValue": 23456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 23496,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 23497,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 23497,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 34567 → 34605 1`] = `
{
  "fullDecomposition": "34567 + 38 = 34567 + 30 + (100 - 90 - 2) = 34605",
  "isMeaningfulDecomposition": true,
  "startValue": 34567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34605,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 38,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 34605,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 45678 → 45719 1`] = `
{
  "fullDecomposition": "45678 + 41 = 45678 + (100 - 60) + 1 = 45719",
  "isMeaningfulDecomposition": true,
  "startValue": 45678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45718,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45719,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 45719,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 56789 → 56827 1`] = `
{
  "fullDecomposition": "56789 + 38 = 56789 + (100 - 70) + (10 - 2) = 56827",
  "isMeaningfulDecomposition": true,
  "startValue": 56789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56827,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 56827,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 67890 → 67935 1`] = `
{
  "fullDecomposition": "67890 + 45 = 67890 + (100 - 60) + 5 = 67935",
  "isMeaningfulDecomposition": true,
  "startValue": 67890,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67990,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67930,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67935,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 67935,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 123456 → 123497 1`] = `
{
  "fullDecomposition": "123456 + 41 = 123456 + 40 + 1 = 123497",
  "isMeaningfulDecomposition": true,
  "startValue": 123456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123496,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123497,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 123497,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 234567 → 234605 1`] = `
{
  "fullDecomposition": "234567 + 38 = 234567 + 30 + (100 - 90 - 2) = 234605",
  "isMeaningfulDecomposition": true,
  "startValue": 234567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234605,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 234605,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 345678 → 345719 1`] = `
{
  "fullDecomposition": "345678 + 41 = 345678 + (100 - 60) + 1 = 345719",
  "isMeaningfulDecomposition": true,
  "startValue": 345678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345718,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345719,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 345719,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 456789 → 456827 1`] = `
{
  "fullDecomposition": "456789 + 38 = 456789 + (100 - 70) + (10 - 2) = 456827",
  "isMeaningfulDecomposition": true,
  "startValue": 456789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456827,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 456827,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 567890 → 567935 1`] = `
{
  "fullDecomposition": "567890 + 45 = 567890 + (100 - 60) + 5 = 567935",
  "isMeaningfulDecomposition": true,
  "startValue": 567890,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567990,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567930,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567935,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 567935,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Mixed Operation Cases > should handle mixed operations: 678901 → 678943 1`] = `
{
  "fullDecomposition": "678901 + 42 = 678901 + 40 + 2 = 678943",
  "isMeaningfulDecomposition": true,
  "startValue": 678901,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 678941,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 678943,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 678943,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 0 → 1 1`] = `
{
  "fullDecomposition": "0 + 1 = 0 + 1 = 1",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 0 → 4 1`] = `
{
  "fullDecomposition": "0 + 4 = 0 + 4 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 0 → 5 1`] = `
{
  "fullDecomposition": "0 + 5 = 0 + 5 = 5",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 0 → 6 1`] = `
{
  "fullDecomposition": "0 + 6 = 0 + 5 + 1 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 0 → 10 1`] = `
{
  "fullDecomposition": "0 + 10 = 0 + 10 = 10",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 1 → 3 1`] = `
{
  "fullDecomposition": "1 + 2 = 1 + 2 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 1 → 5 1`] = `
{
  "fullDecomposition": "1 + 4 = 1 + (5 - 1) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 2 → 3 1`] = `
{
  "fullDecomposition": "2 + 1 = 2 + 1 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 3 → 5 1`] = `
{
  "fullDecomposition": "3 + 2 = 3 + (5 - 3) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 4 → 7 1`] = `
{
  "fullDecomposition": "4 + 3 = 4 + (5 - 2) = 7",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 4 → 11 1`] = `
{
  "fullDecomposition": "4 + 7 = 4 + (10 - 3) = 11",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 5 → 7 1`] = `
{
  "fullDecomposition": "5 + 2 = 5 + 2 = 7",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 5 → 9 1`] = `
{
  "fullDecomposition": "5 + 4 = 5 + 4 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 6 → 15 1`] = `
{
  "fullDecomposition": "6 + 9 = 6 + (10 - 1) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 6,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 7 → 15 1`] = `
{
  "fullDecomposition": "7 + 8 = 7 + (10 - 2) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 7,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 9 → 18 1`] = `
{
  "fullDecomposition": "9 + 9 = 9 + (10 - 1) = 18",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 18,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 12 → 34 1`] = `
{
  "fullDecomposition": "12 + 22 = 12 + 20 + 2 = 34",
  "isMeaningfulDecomposition": true,
  "startValue": 12,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 32,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 34,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 23 → 47 1`] = `
{
  "fullDecomposition": "23 + 24 = 23 + 20 + (5 - 1) = 47",
  "isMeaningfulDecomposition": true,
  "startValue": 23,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 43,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 48,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 47,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 47,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 34 → 78 1`] = `
{
  "fullDecomposition": "34 + 44 = 34 + (50 - 10) + (5 - 1) = 78",
  "isMeaningfulDecomposition": true,
  "startValue": 34,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 84,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 74,
      "isValid": true,
      "mathematicalTerm": "-10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 79,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 78,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 78,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 89 → 97 1`] = `
{
  "fullDecomposition": "89 + 8 = 89 + (10 - 2) = 97",
  "isMeaningfulDecomposition": true,
  "startValue": 89,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 99,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 97,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 97,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Regression Prevention Cases > should maintain regression case: 99 → 107 1`] = `
{
  "fullDecomposition": "99 + 8 = 99 + (100 - 90 - 2) = 107",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 107,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 107,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 4949 → 4983 1`] = `
{
  "fullDecomposition": "4949 + 34 = 4949 + (50 - 20) + (10 - 6) = 4983",
  "isMeaningfulDecomposition": true,
  "startValue": 4949,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4999,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4979,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4983,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4983,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 9999 → 10017 1`] = `
{
  "fullDecomposition": "9999 + 18 = 9999 + (10000 - 9000 - 900 - 90) + (10 - 2) = 10017",
  "isMeaningfulDecomposition": true,
  "startValue": 9999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 41,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10019,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 50,
        "startIndex": 48,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10017,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 53,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10017,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 14949 → 14983 1`] = `
{
  "fullDecomposition": "14949 + 34 = 14949 + (50 - 20) + (10 - 6) = 14983",
  "isMeaningfulDecomposition": true,
  "startValue": 14949,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14999,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14979,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14983,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 14983,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 24949 → 24983 1`] = `
{
  "fullDecomposition": "24949 + 34 = 24949 + (50 - 20) + (10 - 6) = 24983",
  "isMeaningfulDecomposition": true,
  "startValue": 24949,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 24999,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 24979,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 24989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 24983,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 24983,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 49999 → 50034 1`] = `
{
  "fullDecomposition": "49999 + 35 = 49999 + (10000 - 9000 - 900 - 70) + (10 - 5) = 50034",
  "isMeaningfulDecomposition": true,
  "startValue": 49999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 59999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50029,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 45,
        "startIndex": 43,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50039,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 52,
        "startIndex": 50,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50034,
      "isValid": true,
      "mathematicalTerm": "-5",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 56,
        "startIndex": 55,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 50034,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 99999 → 100008 1`] = `
{
  "fullDecomposition": "99999 + 9 = 99999 + (100000 - 90000 - 9000 - 900 - 90 - 1) = 100008",
  "isMeaningfulDecomposition": true,
  "startValue": 99999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 5,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundred-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199999,
      "isValid": true,
      "mathematicalTerm": "100000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 38,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 48,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 53,
        "startIndex": 51,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 57,
        "startIndex": 56,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100008,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 99999 → 100026 1`] = `
{
  "fullDecomposition": "99999 + 27 = 99999 + (100000 - 90000 - 9000 - 900 - 80) + (10 - 3) = 100026",
  "isMeaningfulDecomposition": true,
  "startValue": 99999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 5,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundred-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199999,
      "isValid": true,
      "mathematicalTerm": "100000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 49,
        "startIndex": 46,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 3 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100019,
      "isValid": true,
      "mathematicalTerm": "-80",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 52,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100029,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 61,
        "startIndex": 59,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 6,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 6,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 6,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100026,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 6,
      "termPosition": {
        "endIndex": 65,
        "startIndex": 64,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100026,
  "totalSteps": 7,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 149999 → 150034 1`] = `
{
  "fullDecomposition": "149999 + 35 = 149999 + (10000 - 9000 - 900 - 70) + (10 - 5) = 150034",
  "isMeaningfulDecomposition": true,
  "startValue": 149999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 159999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150029,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 47,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150039,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 52,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150034,
      "isValid": true,
      "mathematicalTerm": "-5",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 58,
        "startIndex": 57,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 150034,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 199999 → 200008 1`] = `
{
  "fullDecomposition": "199999 + 9 = 199999 + (100000 - 90000 - 9000 - 900 - 90 - 1) = 200008",
  "isMeaningfulDecomposition": true,
  "startValue": 199999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 5,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundred-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 299999,
      "isValid": true,
      "mathematicalTerm": "100000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 209999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 44,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 50,
        "startIndex": 47,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 55,
        "startIndex": 53,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 59,
        "startIndex": 58,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200008,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 249999 → 250034 1`] = `
{
  "fullDecomposition": "249999 + 35 = 249999 + (10000 - 9000 - 900 - 70) + (10 - 5) = 250034",
  "isMeaningfulDecomposition": true,
  "startValue": 249999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 259999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250029,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 47,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250039,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 52,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250034,
      "isValid": true,
      "mathematicalTerm": "-5",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 58,
        "startIndex": 57,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 250034,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 999999 → 1000008 1`] = `
{
  "fullDecomposition": "999999 + 9 = 999999 + (1000000 - 900000 - 90000 - 9000 - 900 - 90 - 1) = 1000008",
  "isMeaningfulDecomposition": true,
  "startValue": 999999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 6,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to millions",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999999,
      "isValid": true,
      "mathematicalTerm": "1000000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 5,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 5,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 5,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 5,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 5,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundred-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099999,
      "isValid": true,
      "mathematicalTerm": "-900000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 47,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 50,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 60,
        "startIndex": 57,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 65,
        "startIndex": 63,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 6,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 6,
      "termPosition": {
        "endIndex": 69,
        "startIndex": 68,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000008,
  "totalSteps": 7,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Stress Test Cases > should handle stress test: 999999 → 1000035 1`] = `
{
  "fullDecomposition": "999999 + 36 = 999999 + (1000000 - 900000 - 90000 - 9000 - 900 - 70) + (10 - 4) = 1000035",
  "isMeaningfulDecomposition": true,
  "startValue": 999999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 6,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to millions",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999999,
      "isValid": true,
      "mathematicalTerm": "1000000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 5,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 5,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 5,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 5,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 5,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundred-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099999,
      "isValid": true,
      "mathematicalTerm": "-900000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 48,
        "startIndex": 43,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 55,
        "startIndex": 51,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 61,
        "startIndex": 58,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000029,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 66,
        "startIndex": 64,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 6,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000039,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 6,
      "termPosition": {
        "endIndex": 73,
        "startIndex": 71,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 7,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 7,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 7,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 7,
        },
      ],
      "englishInstruction": "remove 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000035,
      "isValid": true,
      "mathematicalTerm": "-4",
      "stepIndex": 7,
      "termPosition": {
        "endIndex": 77,
        "startIndex": 76,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000035,
  "totalSteps": 8,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 1 (diff: 1) 1`] = `
{
  "fullDecomposition": "0 + 1 = 0 + 1 = 1",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 2 (diff: 2) 1`] = `
{
  "fullDecomposition": "0 + 2 = 0 + 2 = 2",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 3 (diff: 3) 1`] = `
{
  "fullDecomposition": "0 + 3 = 0 + 3 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 4 (diff: 4) 1`] = `
{
  "fullDecomposition": "0 + 4 = 0 + 4 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 5 (diff: 5) 1`] = `
{
  "fullDecomposition": "0 + 5 = 0 + 5 = 5",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 6 (diff: 6) 1`] = `
{
  "fullDecomposition": "0 + 6 = 0 + 5 + 1 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 7 (diff: 7) 1`] = `
{
  "fullDecomposition": "0 + 7 = 0 + 5 + 2 = 7",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 8 (diff: 8) 1`] = `
{
  "fullDecomposition": "0 + 8 = 0 + 5 + 3 = 8",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 8,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 9 (diff: 9) 1`] = `
{
  "fullDecomposition": "0 + 9 = 0 + 5 + 4 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 10 (diff: 10) 1`] = `
{
  "fullDecomposition": "0 + 10 = 0 + 10 = 10",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 11 (diff: 11) 1`] = `
{
  "fullDecomposition": "0 + 11 = 0 + 10 + 1 = 11",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 12 (diff: 12) 1`] = `
{
  "fullDecomposition": "0 + 12 = 0 + 10 + 2 = 12",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 13 (diff: 13) 1`] = `
{
  "fullDecomposition": "0 + 13 = 0 + 10 + 3 = 13",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 13,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 14 (diff: 14) 1`] = `
{
  "fullDecomposition": "0 + 14 = 0 + 10 + 4 = 14",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 14,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 15 (diff: 15) 1`] = `
{
  "fullDecomposition": "0 + 15 = 0 + 10 + 5 = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 16 (diff: 16) 1`] = `
{
  "fullDecomposition": "0 + 16 = 0 + 10 + 5 + 1 = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 17 (diff: 17) 1`] = `
{
  "fullDecomposition": "0 + 17 = 0 + 10 + 5 + 2 = 17",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 17,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 18 (diff: 18) 1`] = `
{
  "fullDecomposition": "0 + 18 = 0 + 10 + 5 + 3 = 18",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 18,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 19 (diff: 19) 1`] = `
{
  "fullDecomposition": "0 + 19 = 0 + 10 + 5 + 4 = 19",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 19,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 20 (diff: 20) 1`] = `
{
  "fullDecomposition": "0 + 20 = 0 + 20 = 20",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 25 (diff: 25) 1`] = `
{
  "fullDecomposition": "0 + 25 = 0 + 20 + 5 = 25",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 25,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 25,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 27 (diff: 27) 1`] = `
{
  "fullDecomposition": "0 + 27 = 0 + 20 + 5 + 2 = 27",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 25,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 27,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 27,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 29 (diff: 29) 1`] = `
{
  "fullDecomposition": "0 + 29 = 0 + 20 + 5 + 4 = 29",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 25,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 29,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 50 (diff: 50) 1`] = `
{
  "fullDecomposition": "0 + 50 = 0 + 50 = 50",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 50,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 100 (diff: 100) 1`] = `
{
  "fullDecomposition": "0 + 100 = 0 + 100 = 100",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 0 → 123 (diff: 123) 1`] = `
{
  "fullDecomposition": "0 + 123 = 0 + 100 + 20 + 3 = 123",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 120,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 123,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 1 → 5 (diff: 4) 1`] = `
{
  "fullDecomposition": "1 + 4 = 1 + (5 - 1) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 1 → 15 (diff: 14) 1`] = `
{
  "fullDecomposition": "1 + 14 = 1 + 10 + (5 - 1) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 2 → 5 (diff: 3) 1`] = `
{
  "fullDecomposition": "2 + 3 = 2 + (5 - 2) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 2 → 15 (diff: 13) 1`] = `
{
  "fullDecomposition": "2 + 13 = 2 + 10 + (5 - 2) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 3 → 5 (diff: 2) 1`] = `
{
  "fullDecomposition": "3 + 2 = 3 + (5 - 3) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 3 → 15 (diff: 12) 1`] = `
{
  "fullDecomposition": "3 + 12 = 3 + 10 + (5 - 3) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 4 → 15 (diff: 11) 1`] = `
{
  "fullDecomposition": "4 + 11 = 4 + 10 + (5 - 4) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-4",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 5 → 6 (diff: 1) 1`] = `
{
  "fullDecomposition": "5 + 1 = 5 + 1 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 5 → 15 (diff: 10) 1`] = `
{
  "fullDecomposition": "5 + 10 = 5 + 10 = 15",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 5 → 25 (diff: 20) 1`] = `
{
  "fullDecomposition": "5 + 20 = 5 + 20 = 25",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 25,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 25,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 6 → 10 (diff: 4) 1`] = `
{
  "fullDecomposition": "6 + 4 = 6 + (10 - 6) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 6,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 7 → 10 (diff: 3) 1`] = `
{
  "fullDecomposition": "7 + 3 = 7 + (10 - 7) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 7,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 8 → 10 (diff: 2) 1`] = `
{
  "fullDecomposition": "8 + 2 = 8 + (10 - 8) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 8,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -8",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-8",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 9 → 10 (diff: 1) 1`] = `
{
  "fullDecomposition": "9 + 1 = 9 + (10 - 9) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 12 → 16 (diff: 4) 1`] = `
{
  "fullDecomposition": "12 + 4 = 12 + (5 - 1) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 12,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 13 → 16 (diff: 3) 1`] = `
{
  "fullDecomposition": "13 + 3 = 13 + (5 - 2) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 13,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 14 → 16 (diff: 2) 1`] = `
{
  "fullDecomposition": "14 + 2 = 14 + (5 - 3) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 14,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 15 → 16 (diff: 1) 1`] = `
{
  "fullDecomposition": "15 + 1 = 15 + 1 = 16",
  "isMeaningfulDecomposition": false,
  "startValue": 15,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 50 → 100 (diff: 50) 1`] = `
{
  "fullDecomposition": "50 + 50 = 50 + (100 - 50) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 50,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-50",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 75 → 100 (diff: 25) 1`] = `
{
  "fullDecomposition": "75 + 25 = 75 + 20 + (100 - 90 - 5) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 75,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 95,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 195,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 105,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-5",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 80 → 100 (diff: 20) 1`] = `
{
  "fullDecomposition": "80 + 20 = 80 + (100 - 80) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 80,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 180,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 3 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-80",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 86 → 100 (diff: 14) 1`] = `
{
  "fullDecomposition": "86 + 14 = 86 + 10 + (100 - 90 - 6) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 86,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 96,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 196,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 106,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 87 → 100 (diff: 13) 1`] = `
{
  "fullDecomposition": "87 + 13 = 87 + 10 + (100 - 90 - 7) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 87,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 97,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 197,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 107,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 88 → 100 (diff: 12) 1`] = `
{
  "fullDecomposition": "88 + 12 = 88 + 10 + (100 - 90 - 8) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 88,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 98,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 198,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 108,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -8",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-8",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 89 → 100 (diff: 11) 1`] = `
{
  "fullDecomposition": "89 + 11 = 89 + 10 + (100 - 90 - 9) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 89,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 99,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 90 → 100 (diff: 10) 1`] = `
{
  "fullDecomposition": "90 + 10 = 90 + (100 - 90) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 90,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 190,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 96 → 100 (diff: 4) 1`] = `
{
  "fullDecomposition": "96 + 4 = 96 + (100 - 90 - 6) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 96,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 196,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 106,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 97 → 100 (diff: 3) 1`] = `
{
  "fullDecomposition": "97 + 3 = 97 + (100 - 90 - 7) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 97,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 197,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 107,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 98 → 100 (diff: 2) 1`] = `
{
  "fullDecomposition": "98 + 2 = 98 + (100 - 90 - 8) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 98,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 198,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 108,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -8",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-8",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 99 → 100 (diff: 1) 1`] = `
{
  "fullDecomposition": "99 + 1 = 99 + (100 - 90 - 9) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 100 → 223 (diff: 123) 1`] = `
{
  "fullDecomposition": "100 + 123 = 100 + 100 + 20 + 3 = 223",
  "isMeaningfulDecomposition": true,
  "startValue": 100,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 220,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 223,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 223,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 180 → 205 (diff: 25) 1`] = `
{
  "fullDecomposition": "180 + 25 = 180 + (100 - 80) + 5 = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 180,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 280,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 3 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "-80",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 185 → 205 (diff: 20) 1`] = `
{
  "fullDecomposition": "185 + 20 = 185 + (100 - 80) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 185,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 285,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 3 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-80",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 191 → 205 (diff: 14) 1`] = `
{
  "fullDecomposition": "191 + 14 = 191 + (100 - 90) + (5 - 1) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 191,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 291,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 201,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 206,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 192 → 205 (diff: 13) 1`] = `
{
  "fullDecomposition": "192 + 13 = 192 + (100 - 90) + (5 - 2) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 192,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 292,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 202,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 207,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 193 → 205 (diff: 12) 1`] = `
{
  "fullDecomposition": "193 + 12 = 193 + (100 - 90) + (5 - 3) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 193,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 293,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 203,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 208,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 194 → 205 (diff: 11) 1`] = `
{
  "fullDecomposition": "194 + 11 = 194 + (100 - 90) + (5 - 4) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 194,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 294,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 204,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 209,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-4",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 195 → 205 (diff: 10) 1`] = `
{
  "fullDecomposition": "195 + 10 = 195 + (100 - 90) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 195,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 295,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 877 → 1000 (diff: 123) 1`] = `
{
  "fullDecomposition": "877 + 123 = 877 + 100 + 20 + (1000 - 900 - 90 - 7) = 1000",
  "isMeaningfulDecomposition": true,
  "startValue": 877,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 977,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 997,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1997,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1097,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1007,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 45,
        "startIndex": 43,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 49,
        "startIndex": 48,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 900 → 1000 (diff: 100) 1`] = `
{
  "fullDecomposition": "900 + 100 = 900 + (1000 - 900) = 1000",
  "isMeaningfulDecomposition": true,
  "startValue": 900,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1900,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Systematic Coverage by Difference > should handle systematic case: 1877 → 2000 (diff: 123) 1`] = `
{
  "fullDecomposition": "1877 + 123 = 1877 + 100 + 20 + (1000 - 900 - 90 - 7) = 2000",
  "isMeaningfulDecomposition": true,
  "startValue": 1877,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1977,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1997,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2997,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2097,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2007,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 47,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2000,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 51,
        "startIndex": 50,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2000,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 1 → 10 1`] = `
{
  "fullDecomposition": "1 + 9 = 1 + (10 - 1) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 2 → 11 1`] = `
{
  "fullDecomposition": "2 + 9 = 2 + (10 - 1) = 11",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 3 → 12 1`] = `
{
  "fullDecomposition": "3 + 9 = 3 + (10 - 1) = 12",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 4 → 11 1`] = `
{
  "fullDecomposition": "4 + 7 = 4 + (10 - 3) = 11",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 6 → 13 1`] = `
{
  "fullDecomposition": "6 + 7 = 6 + (10 - 3) = 13",
  "isMeaningfulDecomposition": true,
  "startValue": 6,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 13,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 7 → 14 1`] = `
{
  "fullDecomposition": "7 + 7 = 7 + (10 - 3) = 14",
  "isMeaningfulDecomposition": true,
  "startValue": 7,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 14,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 7 → 16 1`] = `
{
  "fullDecomposition": "7 + 9 = 7 + (10 - 1) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 7,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 8 → 15 1`] = `
{
  "fullDecomposition": "8 + 7 = 8 + (10 - 3) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 8,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 8 → 17 1`] = `
{
  "fullDecomposition": "8 + 9 = 8 + (10 - 1) = 17",
  "isMeaningfulDecomposition": true,
  "startValue": 8,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 17,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 9 → 16 1`] = `
{
  "fullDecomposition": "9 + 7 = 9 + (10 - 3) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 19 → 26 1`] = `
{
  "fullDecomposition": "19 + 7 = 19 + (10 - 3) = 26",
  "isMeaningfulDecomposition": true,
  "startValue": 19,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 26,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 26,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 28 → 35 1`] = `
{
  "fullDecomposition": "28 + 7 = 28 + (10 - 3) = 35",
  "isMeaningfulDecomposition": true,
  "startValue": 28,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 38,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 35,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 35,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 37 → 44 1`] = `
{
  "fullDecomposition": "37 + 7 = 37 + (10 - 3) = 44",
  "isMeaningfulDecomposition": true,
  "startValue": 37,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 47,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 44,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 44,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 46 → 53 1`] = `
{
  "fullDecomposition": "46 + 7 = 46 + (10 - 3) = 53",
  "isMeaningfulDecomposition": true,
  "startValue": 46,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 53,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 53,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 55 → 62 1`] = `
{
  "fullDecomposition": "55 + 7 = 55 + (10 - 3) = 62",
  "isMeaningfulDecomposition": true,
  "startValue": 55,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 65,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 62,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 62,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 64 → 71 1`] = `
{
  "fullDecomposition": "64 + 7 = 64 + (10 - 3) = 71",
  "isMeaningfulDecomposition": true,
  "startValue": 64,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 74,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 71,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 71,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 73 → 80 1`] = `
{
  "fullDecomposition": "73 + 7 = 73 + (10 - 3) = 80",
  "isMeaningfulDecomposition": true,
  "startValue": 73,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 83,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 80,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 80,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 82 → 89 1`] = `
{
  "fullDecomposition": "82 + 7 = 82 + 5 + 2 = 89",
  "isMeaningfulDecomposition": false,
  "startValue": 82,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 87,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 89,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 89,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 91 → 98 1`] = `
{
  "fullDecomposition": "91 + 7 = 91 + 5 + 2 = 98",
  "isMeaningfulDecomposition": false,
  "startValue": 91,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 96,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 98,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 98,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 94 → 101 1`] = `
{
  "fullDecomposition": "94 + 7 = 94 + (100 - 90 - 3) = 101",
  "isMeaningfulDecomposition": true,
  "startValue": 94,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 194,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 104,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 101,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 101,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 193 → 200 1`] = `
{
  "fullDecomposition": "193 + 7 = 193 + (100 - 90 - 3) = 200",
  "isMeaningfulDecomposition": true,
  "startValue": 193,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 293,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 203,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 294 → 301 1`] = `
{
  "fullDecomposition": "294 + 7 = 294 + (100 - 90 - 3) = 301",
  "isMeaningfulDecomposition": true,
  "startValue": 294,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 394,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 304,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 301,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 301,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 395 → 402 1`] = `
{
  "fullDecomposition": "395 + 7 = 395 + (100 - 90 - 3) = 402",
  "isMeaningfulDecomposition": true,
  "startValue": 395,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 495,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 405,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 402,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 402,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 496 → 503 1`] = `
{
  "fullDecomposition": "496 + 7 = 496 + (100 - 90 - 3) = 503",
  "isMeaningfulDecomposition": true,
  "startValue": 496,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 596,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 506,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 503,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 503,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 597 → 604 1`] = `
{
  "fullDecomposition": "597 + 7 = 597 + (100 - 90 - 3) = 604",
  "isMeaningfulDecomposition": true,
  "startValue": 597,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 604,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 604,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 698 → 705 1`] = `
{
  "fullDecomposition": "698 + 7 = 698 + (100 - 90 - 3) = 705",
  "isMeaningfulDecomposition": true,
  "startValue": 698,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 798,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 708,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 705,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 705,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 799 → 806 1`] = `
{
  "fullDecomposition": "799 + 7 = 799 + (100 - 90 - 3) = 806",
  "isMeaningfulDecomposition": true,
  "startValue": 799,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 899,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 809,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 806,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 806,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 1294 → 1301 1`] = `
{
  "fullDecomposition": "1294 + 7 = 1294 + (100 - 90 - 3) = 1301",
  "isMeaningfulDecomposition": true,
  "startValue": 1294,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1394,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1304,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1301,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1301,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 2395 → 2402 1`] = `
{
  "fullDecomposition": "2395 + 7 = 2395 + (100 - 90 - 3) = 2402",
  "isMeaningfulDecomposition": true,
  "startValue": 2395,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2495,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2405,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2402,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2402,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 3496 → 3503 1`] = `
{
  "fullDecomposition": "3496 + 7 = 3496 + (100 - 90 - 3) = 3503",
  "isMeaningfulDecomposition": true,
  "startValue": 3496,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3596,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3506,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3503,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3503,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests (Legacy) > Ten-Complement Cases > should handle ten-complement: 4597 → 4604 1`] = `
{
  "fullDecomposition": "4597 + 7 = 4597 + (100 - 90 - 3) = 4604",
  "isMeaningfulDecomposition": true,
  "startValue": 4597,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4604,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4604,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 89 → 97 1`] = `
{
  "fullDecomposition": "89 + 8 = 89 + (10 - 2) = 97",
  "isMeaningfulDecomposition": true,
  "startValue": 89,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 99,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 97,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 97,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 98 → 105 1`] = `
{
  "fullDecomposition": "98 + 7 = 98 + (100 - 90 - 3) = 105",
  "isMeaningfulDecomposition": true,
  "startValue": 98,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 198,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 108,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 105,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 105,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 99 → 107 1`] = `
{
  "fullDecomposition": "99 + 8 = 99 + (100 - 90 - 2) = 107",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 107,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 107,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 189 → 197 1`] = `
{
  "fullDecomposition": "189 + 8 = 189 + (10 - 2) = 197",
  "isMeaningfulDecomposition": true,
  "startValue": 189,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 197,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 197,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 198 → 205 1`] = `
{
  "fullDecomposition": "198 + 7 = 198 + (100 - 90 - 3) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 198,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 298,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 208,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 199 → 207 1`] = `
{
  "fullDecomposition": "199 + 8 = 199 + (100 - 90 - 2) = 207",
  "isMeaningfulDecomposition": true,
  "startValue": 199,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 299,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 209,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 207,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 207,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 289 → 297 1`] = `
{
  "fullDecomposition": "289 + 8 = 289 + (10 - 2) = 297",
  "isMeaningfulDecomposition": true,
  "startValue": 289,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 299,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 297,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 297,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 298 → 305 1`] = `
{
  "fullDecomposition": "298 + 7 = 298 + (100 - 90 - 3) = 305",
  "isMeaningfulDecomposition": true,
  "startValue": 298,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 398,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 308,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 305,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 305,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 299 → 307 1`] = `
{
  "fullDecomposition": "299 + 8 = 299 + (100 - 90 - 2) = 307",
  "isMeaningfulDecomposition": true,
  "startValue": 299,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 399,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 309,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 307,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 307,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 389 → 397 1`] = `
{
  "fullDecomposition": "389 + 8 = 389 + (10 - 2) = 397",
  "isMeaningfulDecomposition": true,
  "startValue": 389,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 399,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 397,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 397,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 398 → 405 1`] = `
{
  "fullDecomposition": "398 + 7 = 398 + (100 - 90 - 3) = 405",
  "isMeaningfulDecomposition": true,
  "startValue": 398,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 498,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 408,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 405,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 405,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 399 → 407 1`] = `
{
  "fullDecomposition": "399 + 8 = 399 + (100 - 90 - 2) = 407",
  "isMeaningfulDecomposition": true,
  "startValue": 399,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 499,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 409,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 407,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 407,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 499 → 507 1`] = `
{
  "fullDecomposition": "499 + 8 = 499 + (100 - 90 - 2) = 507",
  "isMeaningfulDecomposition": true,
  "startValue": 499,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 599,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 509,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 507,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 507,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 599 → 607 1`] = `
{
  "fullDecomposition": "599 + 8 = 599 + (100 - 90 - 2) = 607",
  "isMeaningfulDecomposition": true,
  "startValue": 599,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 699,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 609,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 607,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 607,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 699 → 707 1`] = `
{
  "fullDecomposition": "699 + 8 = 699 + (100 - 90 - 2) = 707",
  "isMeaningfulDecomposition": true,
  "startValue": 699,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 799,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 709,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 707,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 707,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 799 → 807 1`] = `
{
  "fullDecomposition": "799 + 8 = 799 + (100 - 90 - 2) = 807",
  "isMeaningfulDecomposition": true,
  "startValue": 799,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 899,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 809,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 807,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 807,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 979 → 986 1`] = `
{
  "fullDecomposition": "979 + 7 = 979 + (10 - 3) = 986",
  "isMeaningfulDecomposition": true,
  "startValue": 979,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 986,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 986,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 989 → 996 1`] = `
{
  "fullDecomposition": "989 + 7 = 989 + (10 - 3) = 996",
  "isMeaningfulDecomposition": true,
  "startValue": 989,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 999,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 996,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 996,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 999 → 1007 1`] = `
{
  "fullDecomposition": "999 + 8 = 999 + (1000 - 900 - 90 - 2) = 1007",
  "isMeaningfulDecomposition": true,
  "startValue": 999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1007,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 1899 → 1907 1`] = `
{
  "fullDecomposition": "1899 + 8 = 1899 + (100 - 90 - 2) = 1907",
  "isMeaningfulDecomposition": true,
  "startValue": 1899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 1979 → 1986 1`] = `
{
  "fullDecomposition": "1979 + 7 = 1979 + (10 - 3) = 1986",
  "isMeaningfulDecomposition": true,
  "startValue": 1979,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1986,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1986,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 1989 → 1996 1`] = `
{
  "fullDecomposition": "1989 + 7 = 1989 + (10 - 3) = 1996",
  "isMeaningfulDecomposition": true,
  "startValue": 1989,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1996,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1996,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 1999 → 2007 1`] = `
{
  "fullDecomposition": "1999 + 8 = 1999 + (1000 - 900 - 90 - 2) = 2007",
  "isMeaningfulDecomposition": true,
  "startValue": 1999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2007,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 2899 → 2907 1`] = `
{
  "fullDecomposition": "2899 + 8 = 2899 + (100 - 90 - 2) = 2907",
  "isMeaningfulDecomposition": true,
  "startValue": 2899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 2979 → 2986 1`] = `
{
  "fullDecomposition": "2979 + 7 = 2979 + (10 - 3) = 2986",
  "isMeaningfulDecomposition": true,
  "startValue": 2979,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2986,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2986,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 2989 → 2996 1`] = `
{
  "fullDecomposition": "2989 + 7 = 2989 + (10 - 3) = 2996",
  "isMeaningfulDecomposition": true,
  "startValue": 2989,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2999,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2996,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2996,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 2999 → 3007 1`] = `
{
  "fullDecomposition": "2999 + 8 = 2999 + (1000 - 900 - 90 - 2) = 3007",
  "isMeaningfulDecomposition": true,
  "startValue": 2999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3007,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 9899 → 9907 1`] = `
{
  "fullDecomposition": "9899 + 8 = 9899 + (100 - 90 - 2) = 9907",
  "isMeaningfulDecomposition": true,
  "startValue": 9899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 9999 → 10007 1`] = `
{
  "fullDecomposition": "9999 + 8 = 9999 + (10000 - 9000 - 900 - 90 - 2) = 10007",
  "isMeaningfulDecomposition": true,
  "startValue": 9999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 46,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10007,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 12899 → 12907 1`] = `
{
  "fullDecomposition": "12899 + 8 = 12899 + (100 - 90 - 2) = 12907",
  "isMeaningfulDecomposition": true,
  "startValue": 12899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 19899 → 19907 1`] = `
{
  "fullDecomposition": "19899 + 8 = 19899 + (100 - 90 - 2) = 19907",
  "isMeaningfulDecomposition": true,
  "startValue": 19899,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19909,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19907,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 19907,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Cascading Complement Cases > should handle cascading complement: 19999 → 20007 1`] = `
{
  "fullDecomposition": "19999 + 8 = 19999 + (10000 - 9000 - 900 - 90 - 2) = 20007",
  "isMeaningfulDecomposition": true,
  "startValue": 19999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 44,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20007,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 48,
        "startIndex": 47,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20007,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 1 1`] = `
{
  "fullDecomposition": "0 + 1 = 0 + 1 = 1",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 2 1`] = `
{
  "fullDecomposition": "0 + 2 = 0 + 2 = 2",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 3 1`] = `
{
  "fullDecomposition": "0 + 3 = 0 + 3 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 4 1`] = `
{
  "fullDecomposition": "0 + 4 = 0 + 4 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 5 1`] = `
{
  "fullDecomposition": "0 + 5 = 0 + 5 = 5",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 10 1`] = `
{
  "fullDecomposition": "0 + 10 = 0 + 10 = 10",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 20 1`] = `
{
  "fullDecomposition": "0 + 20 = 0 + 20 = 20",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 30 1`] = `
{
  "fullDecomposition": "0 + 30 = 0 + 30 = 30",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 30,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 30,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 40 1`] = `
{
  "fullDecomposition": "0 + 40 = 0 + 40 = 40",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 40,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 40,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 50 1`] = `
{
  "fullDecomposition": "0 + 50 = 0 + 50 = 50",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 50,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 100 1`] = `
{
  "fullDecomposition": "0 + 100 = 0 + 100 = 100",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 200 1`] = `
{
  "fullDecomposition": "0 + 200 = 0 + 200 = 200",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "200",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 0 → 300 1`] = `
{
  "fullDecomposition": "0 + 300 = 0 + 300 = 300",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 300,
      "isValid": true,
      "mathematicalTerm": "300",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 300,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 1 → 2 1`] = `
{
  "fullDecomposition": "1 + 1 = 1 + 1 = 2",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 1 → 3 1`] = `
{
  "fullDecomposition": "1 + 2 = 1 + 2 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 1 → 4 1`] = `
{
  "fullDecomposition": "1 + 3 = 1 + 3 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 2 → 3 1`] = `
{
  "fullDecomposition": "2 + 1 = 2 + 1 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 2 → 4 1`] = `
{
  "fullDecomposition": "2 + 2 = 2 + 2 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 3 → 4 1`] = `
{
  "fullDecomposition": "3 + 1 = 3 + 1 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 5 → 6 1`] = `
{
  "fullDecomposition": "5 + 1 = 5 + 1 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 5 → 7 1`] = `
{
  "fullDecomposition": "5 + 2 = 5 + 2 = 7",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 5 → 8 1`] = `
{
  "fullDecomposition": "5 + 3 = 5 + 3 = 8",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 8,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 5 → 9 1`] = `
{
  "fullDecomposition": "5 + 4 = 5 + 4 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 10 → 20 1`] = `
{
  "fullDecomposition": "10 + 10 = 10 + 10 = 20",
  "isMeaningfulDecomposition": false,
  "startValue": 10,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 11 → 22 1`] = `
{
  "fullDecomposition": "11 + 11 = 11 + 10 + 1 = 22",
  "isMeaningfulDecomposition": true,
  "startValue": 11,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 21,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 22,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 22,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 20 → 30 1`] = `
{
  "fullDecomposition": "20 + 10 = 20 + 10 = 30",
  "isMeaningfulDecomposition": false,
  "startValue": 20,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 30,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 30,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 22 → 33 1`] = `
{
  "fullDecomposition": "22 + 11 = 22 + 10 + 1 = 33",
  "isMeaningfulDecomposition": true,
  "startValue": 22,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 32,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 33,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 33,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 30 → 40 1`] = `
{
  "fullDecomposition": "30 + 10 = 30 + 10 = 40",
  "isMeaningfulDecomposition": false,
  "startValue": 30,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 40,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 40,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 40 → 50 1`] = `
{
  "fullDecomposition": "40 + 10 = 40 + (50 - 40) = 50",
  "isMeaningfulDecomposition": true,
  "startValue": 40,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 90,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 4 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50,
      "isValid": true,
      "mathematicalTerm": "-40",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 50,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 100 → 200 1`] = `
{
  "fullDecomposition": "100 + 100 = 100 + 100 = 200",
  "isMeaningfulDecomposition": false,
  "startValue": 100,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Direct Entry Cases (No Complements) > should handle direct entry: 123 → 234 1`] = `
{
  "fullDecomposition": "123 + 111 = 123 + 100 + 10 + 1 = 234",
  "isMeaningfulDecomposition": true,
  "startValue": 123,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 223,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 233,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 234,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 0 → 0 1`] = `
{
  "fullDecomposition": "0 + 0 = 0",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [],
  "targetValue": 0,
  "totalSteps": 0,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 0 → 1 1`] = `
{
  "fullDecomposition": "0 + 1 = 0 + 1 = 1",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 0 → 9 1`] = `
{
  "fullDecomposition": "0 + 9 = 0 + 5 + 4 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 1 → 2 1`] = `
{
  "fullDecomposition": "1 + 1 = 1 + 1 = 2",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 5 → 5 1`] = `
{
  "fullDecomposition": "5 + 0 = 5",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [],
  "targetValue": 5,
  "totalSteps": 0,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 9 → 10 1`] = `
{
  "fullDecomposition": "9 + 1 = 9 + (10 - 9) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 9 → 10 2`] = `
{
  "fullDecomposition": "9 + 1 = 9 + (10 - 9) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 9 → 18 1`] = `
{
  "fullDecomposition": "9 + 9 = 9 + (10 - 1) = 18",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 18,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 10 → 10 1`] = `
{
  "fullDecomposition": "10 + 0 = 10",
  "isMeaningfulDecomposition": false,
  "startValue": 10,
  "steps": [],
  "targetValue": 10,
  "totalSteps": 0,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 10 → 19 1`] = `
{
  "fullDecomposition": "10 + 9 = 10 + 5 + 4 = 19",
  "isMeaningfulDecomposition": false,
  "startValue": 10,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 19,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 19 → 20 1`] = `
{
  "fullDecomposition": "19 + 1 = 19 + (10 - 9) = 20",
  "isMeaningfulDecomposition": true,
  "startValue": 19,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 90 → 99 1`] = `
{
  "fullDecomposition": "90 + 9 = 90 + 5 + 4 = 99",
  "isMeaningfulDecomposition": false,
  "startValue": 90,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 95,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 99,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 99,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 99 → 100 1`] = `
{
  "fullDecomposition": "99 + 1 = 99 + (100 - 90 - 9) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 99 → 100 2`] = `
{
  "fullDecomposition": "99 + 1 = 99 + (100 - 90 - 9) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 99 → 108 1`] = `
{
  "fullDecomposition": "99 + 9 = 99 + (100 - 90 - 1) = 108",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 108,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 108,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 123 → 123 1`] = `
{
  "fullDecomposition": "123 + 0 = 123",
  "isMeaningfulDecomposition": false,
  "startValue": 123,
  "steps": [],
  "targetValue": 123,
  "totalSteps": 0,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 199 → 200 1`] = `
{
  "fullDecomposition": "199 + 1 = 199 + (100 - 90 - 9) = 200",
  "isMeaningfulDecomposition": true,
  "startValue": 199,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 299,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 209,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 900 → 909 1`] = `
{
  "fullDecomposition": "900 + 9 = 900 + 5 + 4 = 909",
  "isMeaningfulDecomposition": false,
  "startValue": 900,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 905,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 909,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 909,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 999 → 1000 1`] = `
{
  "fullDecomposition": "999 + 1 = 999 + (1000 - 900 - 90 - 9) = 1000",
  "isMeaningfulDecomposition": true,
  "startValue": 999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 999 → 1000 2`] = `
{
  "fullDecomposition": "999 + 1 = 999 + (1000 - 900 - 90 - 9) = 1000",
  "isMeaningfulDecomposition": true,
  "startValue": 999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 999 → 1008 1`] = `
{
  "fullDecomposition": "999 + 9 = 999 + (1000 - 900 - 90 - 1) = 1008",
  "isMeaningfulDecomposition": true,
  "startValue": 999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1008,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 1111 → 1123 1`] = `
{
  "fullDecomposition": "1111 + 12 = 1111 + 10 + 2 = 1123",
  "isMeaningfulDecomposition": true,
  "startValue": 1111,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1121,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1123,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1123,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 1357 → 1369 1`] = `
{
  "fullDecomposition": "1357 + 12 = 1357 + 10 + 2 = 1369",
  "isMeaningfulDecomposition": true,
  "startValue": 1357,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1367,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1369,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1369,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 1999 → 2000 1`] = `
{
  "fullDecomposition": "1999 + 1 = 1999 + (1000 - 900 - 90 - 9) = 2000",
  "isMeaningfulDecomposition": true,
  "startValue": 1999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2999,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2000,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 2222 → 2234 1`] = `
{
  "fullDecomposition": "2222 + 12 = 2222 + 10 + 2 = 2234",
  "isMeaningfulDecomposition": true,
  "startValue": 2222,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2232,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2234,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2234,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 2468 → 2479 1`] = `
{
  "fullDecomposition": "2468 + 11 = 2468 + 10 + 1 = 2479",
  "isMeaningfulDecomposition": true,
  "startValue": 2468,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2478,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2479,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2479,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 3333 → 3345 1`] = `
{
  "fullDecomposition": "3333 + 12 = 3333 + 10 + (5 - 3) = 3345",
  "isMeaningfulDecomposition": true,
  "startValue": 3333,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3343,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3348,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3345,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3345,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 9999 → 10000 1`] = `
{
  "fullDecomposition": "9999 + 1 = 9999 + (10000 - 9000 - 900 - 90 - 9) = 10000",
  "isMeaningfulDecomposition": true,
  "startValue": 9999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 46,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10000,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 9999 → 10008 1`] = `
{
  "fullDecomposition": "9999 + 9 = 9999 + (10000 - 9000 - 900 - 90 - 1) = 10008",
  "isMeaningfulDecomposition": true,
  "startValue": 9999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 46,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10008,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 11111 → 11123 1`] = `
{
  "fullDecomposition": "11111 + 12 = 11111 + 10 + 2 = 11123",
  "isMeaningfulDecomposition": true,
  "startValue": 11111,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11121,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11123,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11123,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 13579 → 13591 1`] = `
{
  "fullDecomposition": "13579 + 12 = 13579 + 10 + (10 - 8) = 13591",
  "isMeaningfulDecomposition": true,
  "startValue": 13579,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13589,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13599,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -8",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13591,
      "isValid": true,
      "mathematicalTerm": "-8",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 13591,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 19999 → 20000 1`] = `
{
  "fullDecomposition": "19999 + 1 = 19999 + (10000 - 9000 - 900 - 90 - 9) = 20000",
  "isMeaningfulDecomposition": true,
  "startValue": 19999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 44,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20000,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 48,
        "startIndex": 47,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20000,
  "totalSteps": 5,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Edge Cases and Boundary Conditions > should handle edge case: 22222 → 22234 1`] = `
{
  "fullDecomposition": "22222 + 12 = 22222 + 10 + 2 = 22234",
  "isMeaningfulDecomposition": true,
  "startValue": 22222,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 22232,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 22234,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 22234,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 1 → 4 1`] = `
{
  "fullDecomposition": "1 + 3 = 1 + 3 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 1 → 5 1`] = `
{
  "fullDecomposition": "1 + 4 = 1 + (5 - 1) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 1 → 6 1`] = `
{
  "fullDecomposition": "1 + 5 = 1 + 5 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 2 → 5 1`] = `
{
  "fullDecomposition": "2 + 3 = 2 + (5 - 2) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 2 → 6 1`] = `
{
  "fullDecomposition": "2 + 4 = 2 + (5 - 1) = 6",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 2 → 7 1`] = `
{
  "fullDecomposition": "2 + 5 = 2 + 5 = 7",
  "isMeaningfulDecomposition": false,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 3 → 6 1`] = `
{
  "fullDecomposition": "3 + 3 = 3 + (5 - 2) = 6",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 3 → 7 1`] = `
{
  "fullDecomposition": "3 + 4 = 3 + (5 - 1) = 7",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 3 → 8 1`] = `
{
  "fullDecomposition": "3 + 5 = 3 + 5 = 8",
  "isMeaningfulDecomposition": false,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 8,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 4 → 7 1`] = `
{
  "fullDecomposition": "4 + 3 = 4 + (5 - 2) = 7",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 4 → 8 1`] = `
{
  "fullDecomposition": "4 + 4 = 4 + (5 - 1) = 8",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 8,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 4 → 9 1`] = `
{
  "fullDecomposition": "4 + 5 = 4 + 5 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 14 → 17 1`] = `
{
  "fullDecomposition": "14 + 3 = 14 + (5 - 2) = 17",
  "isMeaningfulDecomposition": true,
  "startValue": 14,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 17,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 23 → 26 1`] = `
{
  "fullDecomposition": "23 + 3 = 23 + (5 - 2) = 26",
  "isMeaningfulDecomposition": true,
  "startValue": 23,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 28,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 26,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 26,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 31 → 34 1`] = `
{
  "fullDecomposition": "31 + 3 = 31 + 3 = 34",
  "isMeaningfulDecomposition": false,
  "startValue": 31,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 34,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 40 → 70 1`] = `
{
  "fullDecomposition": "40 + 30 = 40 + (50 - 20) = 70",
  "isMeaningfulDecomposition": true,
  "startValue": 40,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 90,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 70,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 70,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 42 → 45 1`] = `
{
  "fullDecomposition": "42 + 3 = 42 + (5 - 2) = 45",
  "isMeaningfulDecomposition": true,
  "startValue": 42,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 47,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 45,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 54 → 57 1`] = `
{
  "fullDecomposition": "54 + 3 = 54 + (5 - 2) = 57",
  "isMeaningfulDecomposition": true,
  "startValue": 54,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 59,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 57,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 57,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 134 → 137 1`] = `
{
  "fullDecomposition": "134 + 3 = 134 + (5 - 2) = 137",
  "isMeaningfulDecomposition": true,
  "startValue": 134,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 139,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 137,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 137,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 223 → 226 1`] = `
{
  "fullDecomposition": "223 + 3 = 223 + (5 - 2) = 226",
  "isMeaningfulDecomposition": true,
  "startValue": 223,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 228,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 226,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 226,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 314 → 317 1`] = `
{
  "fullDecomposition": "314 + 3 = 314 + (5 - 2) = 317",
  "isMeaningfulDecomposition": true,
  "startValue": 314,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 319,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 317,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 317,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 400 → 700 1`] = `
{
  "fullDecomposition": "400 + 300 = 400 + (500 - 200) = 700",
  "isMeaningfulDecomposition": true,
  "startValue": 400,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 900,
      "isValid": true,
      "mathematicalTerm": "500",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 700,
      "isValid": true,
      "mathematicalTerm": "-200",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 700,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 425 → 428 1`] = `
{
  "fullDecomposition": "425 + 3 = 425 + 3 = 428",
  "isMeaningfulDecomposition": false,
  "startValue": 425,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 428,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 428,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 1234 → 1237 1`] = `
{
  "fullDecomposition": "1234 + 3 = 1234 + (5 - 2) = 1237",
  "isMeaningfulDecomposition": true,
  "startValue": 1234,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1239,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1237,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1237,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 1400 → 1700 1`] = `
{
  "fullDecomposition": "1400 + 300 = 1400 + (500 - 200) = 1700",
  "isMeaningfulDecomposition": true,
  "startValue": 1400,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1900,
      "isValid": true,
      "mathematicalTerm": "500",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1700,
      "isValid": true,
      "mathematicalTerm": "-200",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1700,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 2341 → 2344 1`] = `
{
  "fullDecomposition": "2341 + 3 = 2341 + 3 = 2344",
  "isMeaningfulDecomposition": false,
  "startValue": 2341,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2344,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2344,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 3452 → 3455 1`] = `
{
  "fullDecomposition": "3452 + 3 = 3452 + (5 - 2) = 3455",
  "isMeaningfulDecomposition": true,
  "startValue": 3452,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3457,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3455,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3455,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Five-Complement Cases > should handle five-complement: 24000 → 27000 1`] = `
{
  "fullDecomposition": "24000 + 3000 = 24000 + (5000 - 2000) = 27000",
  "isMeaningfulDecomposition": true,
  "startValue": 24000,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29000,
      "isValid": true,
      "mathematicalTerm": "5000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from thousands",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 27000,
      "isValid": true,
      "mathematicalTerm": "-2000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 27000,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 12345 → 12378 1`] = `
{
  "fullDecomposition": "12345 + 33 = 12345 + (50 - 20) + 3 = 12378",
  "isMeaningfulDecomposition": true,
  "startValue": 12345,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12395,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12375,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12378,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12378,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 23456 → 23489 1`] = `
{
  "fullDecomposition": "23456 + 33 = 23456 + 30 + 3 = 23489",
  "isMeaningfulDecomposition": true,
  "startValue": 23456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 23486,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 23489,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 23489,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 34567 → 34599 1`] = `
{
  "fullDecomposition": "34567 + 32 = 34567 + 30 + 2 = 34599",
  "isMeaningfulDecomposition": true,
  "startValue": 34567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34599,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 34599,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 45678 → 45711 1`] = `
{
  "fullDecomposition": "45678 + 33 = 45678 + (100 - 70) + (10 - 7) = 45711",
  "isMeaningfulDecomposition": true,
  "startValue": 45678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45708,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45718,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45711,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 45711,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 56789 → 56822 1`] = `
{
  "fullDecomposition": "56789 + 33 = 56789 + (100 - 70) + (10 - 7) = 56822",
  "isMeaningfulDecomposition": true,
  "startValue": 56789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56822,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 56822,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 67890 → 67923 1`] = `
{
  "fullDecomposition": "67890 + 33 = 67890 + (100 - 70) + 3 = 67923",
  "isMeaningfulDecomposition": true,
  "startValue": 67890,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67990,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67920,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67923,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 67923,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 123456 → 123489 1`] = `
{
  "fullDecomposition": "123456 + 33 = 123456 + 30 + 3 = 123489",
  "isMeaningfulDecomposition": true,
  "startValue": 123456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123486,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123489,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 123489,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 234567 → 234599 1`] = `
{
  "fullDecomposition": "234567 + 32 = 234567 + 30 + 2 = 234599",
  "isMeaningfulDecomposition": true,
  "startValue": 234567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234599,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 234599,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 345678 → 345711 1`] = `
{
  "fullDecomposition": "345678 + 33 = 345678 + (100 - 70) + (10 - 7) = 345711",
  "isMeaningfulDecomposition": true,
  "startValue": 345678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345708,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345718,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345711,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 345711,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 456789 → 456822 1`] = `
{
  "fullDecomposition": "456789 + 33 = 456789 + (100 - 70) + (10 - 7) = 456822",
  "isMeaningfulDecomposition": true,
  "startValue": 456789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456822,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 456822,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 567890 → 567923 1`] = `
{
  "fullDecomposition": "567890 + 33 = 567890 + (100 - 70) + 3 = 567923",
  "isMeaningfulDecomposition": true,
  "startValue": 567890,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567990,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567920,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567923,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 567923,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 678901 → 678934 1`] = `
{
  "fullDecomposition": "678901 + 33 = 678901 + 30 + 3 = 678934",
  "isMeaningfulDecomposition": true,
  "startValue": 678901,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 678931,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 678934,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 678934,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 1234567 → 1234599 1`] = `
{
  "fullDecomposition": "1234567 + 32 = 1234567 + 30 + 2 = 1234599",
  "isMeaningfulDecomposition": true,
  "startValue": 1234567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1234597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1234599,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1234599,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 2345678 → 2345711 1`] = `
{
  "fullDecomposition": "2345678 + 33 = 2345678 + (100 - 70) + (10 - 7) = 2345711",
  "isMeaningfulDecomposition": true,
  "startValue": 2345678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2345778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2345708,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2345718,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2345711,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 45,
        "startIndex": 44,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2345711,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Large Number Operations > should handle large numbers: 3456789 → 3456822 1`] = `
{
  "fullDecomposition": "3456789 + 33 = 3456789 + (100 - 70) + (10 - 7) = 3456822",
  "isMeaningfulDecomposition": true,
  "startValue": 3456789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3456889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3456819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3456829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3456822,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 45,
        "startIndex": 44,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3456822,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 43 → 51 1`] = `
{
  "fullDecomposition": "43 + 8 = 43 + (10 - 2) = 51",
  "isMeaningfulDecomposition": true,
  "startValue": 43,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 53,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 51,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 51,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 134 → 142 1`] = `
{
  "fullDecomposition": "134 + 8 = 134 + (10 - 2) = 142",
  "isMeaningfulDecomposition": true,
  "startValue": 134,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 144,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 142,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 142,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 243 → 251 1`] = `
{
  "fullDecomposition": "243 + 8 = 243 + (10 - 2) = 251",
  "isMeaningfulDecomposition": true,
  "startValue": 243,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 253,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 251,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 251,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 352 → 360 1`] = `
{
  "fullDecomposition": "352 + 8 = 352 + (10 - 2) = 360",
  "isMeaningfulDecomposition": true,
  "startValue": 352,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 362,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 360,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 360,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 1234 → 1279 1`] = `
{
  "fullDecomposition": "1234 + 45 = 1234 + (50 - 10) + 5 = 1279",
  "isMeaningfulDecomposition": true,
  "startValue": 1234,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1284,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1274,
      "isValid": true,
      "mathematicalTerm": "-10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1279,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1279,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 2345 → 2383 1`] = `
{
  "fullDecomposition": "2345 + 38 = 2345 + (50 - 20) + (10 - 2) = 2383",
  "isMeaningfulDecomposition": true,
  "startValue": 2345,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2395,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2375,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2385,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2383,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2383,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 3456 → 3497 1`] = `
{
  "fullDecomposition": "3456 + 41 = 3456 + 40 + 1 = 3497",
  "isMeaningfulDecomposition": true,
  "startValue": 3456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3496,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3497,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3497,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 4567 → 4605 1`] = `
{
  "fullDecomposition": "4567 + 38 = 4567 + 30 + (100 - 90 - 2) = 4605",
  "isMeaningfulDecomposition": true,
  "startValue": 4567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4605,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4605,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 5678 → 5719 1`] = `
{
  "fullDecomposition": "5678 + 41 = 5678 + (100 - 60) + 1 = 5719",
  "isMeaningfulDecomposition": true,
  "startValue": 5678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5718,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5719,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5719,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 6789 → 6827 1`] = `
{
  "fullDecomposition": "6789 + 38 = 6789 + (100 - 70) + (10 - 2) = 6827",
  "isMeaningfulDecomposition": true,
  "startValue": 6789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6827,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 38,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6827,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 12345 → 12389 1`] = `
{
  "fullDecomposition": "12345 + 44 = 12345 + (50 - 10) + 4 = 12389",
  "isMeaningfulDecomposition": true,
  "startValue": 12345,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12395,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 from tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12385,
      "isValid": true,
      "mathematicalTerm": "-10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12389,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12389,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 23456 → 23497 1`] = `
{
  "fullDecomposition": "23456 + 41 = 23456 + 40 + 1 = 23497",
  "isMeaningfulDecomposition": true,
  "startValue": 23456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 23496,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 23497,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 23497,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 34567 → 34605 1`] = `
{
  "fullDecomposition": "34567 + 38 = 34567 + 30 + (100 - 90 - 2) = 34605",
  "isMeaningfulDecomposition": true,
  "startValue": 34567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34605,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 38,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 34605,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 45678 → 45719 1`] = `
{
  "fullDecomposition": "45678 + 41 = 45678 + (100 - 60) + 1 = 45719",
  "isMeaningfulDecomposition": true,
  "startValue": 45678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45718,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 45719,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 45719,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 56789 → 56827 1`] = `
{
  "fullDecomposition": "56789 + 38 = 56789 + (100 - 70) + (10 - 2) = 56827",
  "isMeaningfulDecomposition": true,
  "startValue": 56789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56827,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 56827,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 67890 → 67935 1`] = `
{
  "fullDecomposition": "67890 + 45 = 67890 + (100 - 60) + 5 = 67935",
  "isMeaningfulDecomposition": true,
  "startValue": 67890,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67990,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67930,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 67935,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 67935,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 123456 → 123497 1`] = `
{
  "fullDecomposition": "123456 + 41 = 123456 + 40 + 1 = 123497",
  "isMeaningfulDecomposition": true,
  "startValue": 123456,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123496,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123497,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 123497,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 234567 → 234605 1`] = `
{
  "fullDecomposition": "234567 + 38 = 234567 + 30 + (100 - 90 - 2) = 234605",
  "isMeaningfulDecomposition": true,
  "startValue": 234567,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234597,
      "isValid": true,
      "mathematicalTerm": "30",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 234605,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 41,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 234605,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 345678 → 345719 1`] = `
{
  "fullDecomposition": "345678 + 41 = 345678 + (100 - 60) + 1 = 345719",
  "isMeaningfulDecomposition": true,
  "startValue": 345678,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345778,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345718,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 345719,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 345719,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 456789 → 456827 1`] = `
{
  "fullDecomposition": "456789 + 38 = 456789 + (100 - 70) + (10 - 2) = 456827",
  "isMeaningfulDecomposition": true,
  "startValue": 456789,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456889,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456819,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456829,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 456827,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 456827,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 567890 → 567935 1`] = `
{
  "fullDecomposition": "567890 + 45 = 567890 + (100 - 60) + 5 = 567935",
  "isMeaningfulDecomposition": true,
  "startValue": 567890,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567990,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 1 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567930,
      "isValid": true,
      "mathematicalTerm": "-60",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 567935,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 36,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 567935,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Mixed Operation Cases > should handle mixed operations: 678901 → 678943 1`] = `
{
  "fullDecomposition": "678901 + 42 = 678901 + 40 + 2 = 678943",
  "isMeaningfulDecomposition": true,
  "startValue": 678901,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 678941,
      "isValid": true,
      "mathematicalTerm": "40",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 678943,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 678943,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 0 → 1 1`] = `
{
  "fullDecomposition": "0 + 1 = 0 + 1 = 1",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 0 → 4 1`] = `
{
  "fullDecomposition": "0 + 4 = 0 + 4 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 0 → 5 1`] = `
{
  "fullDecomposition": "0 + 5 = 0 + 5 = 5",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 0 → 6 1`] = `
{
  "fullDecomposition": "0 + 6 = 0 + 5 + 1 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 0 → 10 1`] = `
{
  "fullDecomposition": "0 + 10 = 0 + 10 = 10",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 1 → 3 1`] = `
{
  "fullDecomposition": "1 + 2 = 1 + 2 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 1 → 5 1`] = `
{
  "fullDecomposition": "1 + 4 = 1 + (5 - 1) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 2 → 3 1`] = `
{
  "fullDecomposition": "2 + 1 = 2 + 1 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 3 → 5 1`] = `
{
  "fullDecomposition": "3 + 2 = 3 + (5 - 3) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 4 → 7 1`] = `
{
  "fullDecomposition": "4 + 3 = 4 + (5 - 2) = 7",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 4 → 11 1`] = `
{
  "fullDecomposition": "4 + 7 = 4 + (10 - 3) = 11",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 5 → 7 1`] = `
{
  "fullDecomposition": "5 + 2 = 5 + 2 = 7",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 5 → 9 1`] = `
{
  "fullDecomposition": "5 + 4 = 5 + 4 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 6 → 15 1`] = `
{
  "fullDecomposition": "6 + 9 = 6 + (10 - 1) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 6,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 7 → 15 1`] = `
{
  "fullDecomposition": "7 + 8 = 7 + (10 - 2) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 7,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 9 → 18 1`] = `
{
  "fullDecomposition": "9 + 9 = 9 + (10 - 1) = 18",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 18,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 12 → 34 1`] = `
{
  "fullDecomposition": "12 + 22 = 12 + 20 + 2 = 34",
  "isMeaningfulDecomposition": true,
  "startValue": 12,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 32,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 34,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 34,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 23 → 47 1`] = `
{
  "fullDecomposition": "23 + 24 = 23 + 20 + (5 - 1) = 47",
  "isMeaningfulDecomposition": true,
  "startValue": 23,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 43,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 48,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 47,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 47,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 34 → 78 1`] = `
{
  "fullDecomposition": "34 + 44 = 34 + (50 - 10) + (5 - 1) = 78",
  "isMeaningfulDecomposition": true,
  "startValue": 34,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 84,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 74,
      "isValid": true,
      "mathematicalTerm": "-10",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 79,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 78,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 78,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 89 → 97 1`] = `
{
  "fullDecomposition": "89 + 8 = 89 + (10 - 2) = 97",
  "isMeaningfulDecomposition": true,
  "startValue": 89,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 99,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 97,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 97,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Regression Prevention Cases > should maintain regression case: 99 → 107 1`] = `
{
  "fullDecomposition": "99 + 8 = 99 + (100 - 90 - 2) = 107",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 107,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 107,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 4949 → 4983 1`] = `
{
  "fullDecomposition": "4949 + 34 = 4949 + (50 - 20) + (10 - 6) = 4983",
  "isMeaningfulDecomposition": true,
  "startValue": 4949,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4999,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4979,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4983,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4983,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 9999 → 10017 1`] = `
{
  "fullDecomposition": "9999 + 18 = 9999 + (10000 - 9000 - 900 - 90) + (10 - 2) = 10017",
  "isMeaningfulDecomposition": true,
  "startValue": 9999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 38,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 41,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10019,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 50,
        "startIndex": 48,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10017,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 53,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10017,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 14949 → 14983 1`] = `
{
  "fullDecomposition": "14949 + 34 = 14949 + (50 - 20) + (10 - 6) = 14983",
  "isMeaningfulDecomposition": true,
  "startValue": 14949,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14999,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14979,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14983,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 14983,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 24949 → 24983 1`] = `
{
  "fullDecomposition": "24949 + 34 = 24949 + (50 - 20) + (10 - 6) = 24983",
  "isMeaningfulDecomposition": true,
  "startValue": 24949,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 24999,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 from tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 24979,
      "isValid": true,
      "mathematicalTerm": "-20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 24989,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 24983,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 24983,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 49999 → 50034 1`] = `
{
  "fullDecomposition": "49999 + 35 = 49999 + (10000 - 9000 - 900 - 70) + (10 - 5) = 50034",
  "isMeaningfulDecomposition": true,
  "startValue": 49999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 59999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50029,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 45,
        "startIndex": 43,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50039,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 52,
        "startIndex": 50,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50034,
      "isValid": true,
      "mathematicalTerm": "-5",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 56,
        "startIndex": 55,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 50034,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 99999 → 100008 1`] = `
{
  "fullDecomposition": "99999 + 9 = 99999 + (100000 - 90000 - 9000 - 900 - 90 - 1) = 100008",
  "isMeaningfulDecomposition": true,
  "startValue": 99999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 5,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundred-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199999,
      "isValid": true,
      "mathematicalTerm": "100000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 35,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 38,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 48,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 53,
        "startIndex": 51,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 57,
        "startIndex": 56,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100008,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 99999 → 100026 1`] = `
{
  "fullDecomposition": "99999 + 27 = 99999 + (100000 - 90000 - 9000 - 900 - 80) + (10 - 3) = 100026",
  "isMeaningfulDecomposition": true,
  "startValue": 99999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 5,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundred-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199999,
      "isValid": true,
      "mathematicalTerm": "100000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 43,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 49,
        "startIndex": 46,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 3 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100019,
      "isValid": true,
      "mathematicalTerm": "-80",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 52,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100029,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 61,
        "startIndex": 59,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 6,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 6,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 6,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100026,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 6,
      "termPosition": {
        "endIndex": 65,
        "startIndex": 64,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100026,
  "totalSteps": 7,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 149999 → 150034 1`] = `
{
  "fullDecomposition": "149999 + 35 = 149999 + (10000 - 9000 - 900 - 70) + (10 - 5) = 150034",
  "isMeaningfulDecomposition": true,
  "startValue": 149999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 159999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150029,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 47,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150039,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 52,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150034,
      "isValid": true,
      "mathematicalTerm": "-5",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 58,
        "startIndex": 57,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 150034,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 199999 → 200008 1`] = `
{
  "fullDecomposition": "199999 + 9 = 199999 + (100000 - 90000 - 9000 - 900 - 90 - 1) = 200008",
  "isMeaningfulDecomposition": true,
  "startValue": 199999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 5,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundred-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 299999,
      "isValid": true,
      "mathematicalTerm": "100000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 209999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 37,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 44,
        "startIndex": 40,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 50,
        "startIndex": 47,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 55,
        "startIndex": 53,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 59,
        "startIndex": 58,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200008,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 249999 → 250034 1`] = `
{
  "fullDecomposition": "249999 + 35 = 249999 + (10000 - 9000 - 900 - 70) + (10 - 5) = 250034",
  "isMeaningfulDecomposition": true,
  "startValue": 249999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to ten-thousands",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 259999,
      "isValid": true,
      "mathematicalTerm": "10000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250029,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 47,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250039,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 52,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 250034,
      "isValid": true,
      "mathematicalTerm": "-5",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 58,
        "startIndex": 57,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 250034,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 999999 → 1000008 1`] = `
{
  "fullDecomposition": "999999 + 9 = 999999 + (1000000 - 900000 - 90000 - 9000 - 900 - 90 - 1) = 1000008",
  "isMeaningfulDecomposition": true,
  "startValue": 999999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 6,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to millions",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999999,
      "isValid": true,
      "mathematicalTerm": "1000000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 5,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 5,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 5,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 5,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 5,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundred-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099999,
      "isValid": true,
      "mathematicalTerm": "-900000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 39,
        "startIndex": 33,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 47,
        "startIndex": 42,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 54,
        "startIndex": 50,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 60,
        "startIndex": 57,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000009,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 65,
        "startIndex": 63,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 6,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000008,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 6,
      "termPosition": {
        "endIndex": 69,
        "startIndex": 68,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000008,
  "totalSteps": 7,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Stress Test Cases > should handle stress test: 999999 → 1000035 1`] = `
{
  "fullDecomposition": "999999 + 36 = 999999 + (1000000 - 900000 - 90000 - 9000 - 900 - 70) + (10 - 4) = 1000035",
  "isMeaningfulDecomposition": true,
  "startValue": 999999,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 6,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to millions",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1999999,
      "isValid": true,
      "mathematicalTerm": "1000000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 5,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 5,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 5,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 5,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 5,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundred-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1099999,
      "isValid": true,
      "mathematicalTerm": "-900000",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 34,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 4,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 4,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 4,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 4,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 4,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in ten-thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1009999,
      "isValid": true,
      "mathematicalTerm": "-90000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 48,
        "startIndex": 43,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 3,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 3,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in thousands column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000999,
      "isValid": true,
      "mathematicalTerm": "-9000",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 55,
        "startIndex": 51,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000099,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 61,
        "startIndex": 58,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 2 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000029,
      "isValid": true,
      "mathematicalTerm": "-70",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 66,
        "startIndex": 64,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 6,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000039,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 6,
      "termPosition": {
        "endIndex": 73,
        "startIndex": 71,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 7,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 7,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 7,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 7,
        },
      ],
      "englishInstruction": "remove 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "5": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "6": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "7": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000035,
      "isValid": true,
      "mathematicalTerm": "-4",
      "stepIndex": 7,
      "termPosition": {
        "endIndex": 77,
        "startIndex": 76,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000035,
  "totalSteps": 8,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 1 (diff: 1) 1`] = `
{
  "fullDecomposition": "0 + 1 = 0 + 1 = 1",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 2 (diff: 2) 1`] = `
{
  "fullDecomposition": "0 + 2 = 0 + 2 = 2",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 3 (diff: 3) 1`] = `
{
  "fullDecomposition": "0 + 3 = 0 + 3 = 3",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 4 (diff: 4) 1`] = `
{
  "fullDecomposition": "0 + 4 = 0 + 4 = 4",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 5 (diff: 5) 1`] = `
{
  "fullDecomposition": "0 + 5 = 0 + 5 = 5",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 6 (diff: 6) 1`] = `
{
  "fullDecomposition": "0 + 6 = 0 + 5 + 1 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 7 (diff: 7) 1`] = `
{
  "fullDecomposition": "0 + 7 = 0 + 5 + 2 = 7",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 7,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 8 (diff: 8) 1`] = `
{
  "fullDecomposition": "0 + 8 = 0 + 5 + 3 = 8",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 8,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 9 (diff: 9) 1`] = `
{
  "fullDecomposition": "0 + 9 = 0 + 5 + 4 = 9",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 9,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 9,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 10 (diff: 10) 1`] = `
{
  "fullDecomposition": "0 + 10 = 0 + 10 = 10",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 11 (diff: 11) 1`] = `
{
  "fullDecomposition": "0 + 11 = 0 + 10 + 1 = 11",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 12 (diff: 12) 1`] = `
{
  "fullDecomposition": "0 + 12 = 0 + 10 + 2 = 12",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 13 (diff: 13) 1`] = `
{
  "fullDecomposition": "0 + 13 = 0 + 10 + 3 = 13",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 13,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 14 (diff: 14) 1`] = `
{
  "fullDecomposition": "0 + 14 = 0 + 10 + 4 = 14",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 14,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 15 (diff: 15) 1`] = `
{
  "fullDecomposition": "0 + 15 = 0 + 10 + 5 = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 16 (diff: 16) 1`] = `
{
  "fullDecomposition": "0 + 16 = 0 + 10 + 5 + 1 = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 17 (diff: 17) 1`] = `
{
  "fullDecomposition": "0 + 17 = 0 + 10 + 5 + 2 = 17",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 17,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 18 (diff: 18) 1`] = `
{
  "fullDecomposition": "0 + 18 = 0 + 10 + 5 + 3 = 18",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 18,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 19 (diff: 19) 1`] = `
{
  "fullDecomposition": "0 + 19 = 0 + 10 + 5 + 4 = 19",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 19,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 20 (diff: 20) 1`] = `
{
  "fullDecomposition": "0 + 20 = 0 + 20 = 20",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 20,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 25 (diff: 25) 1`] = `
{
  "fullDecomposition": "0 + 25 = 0 + 20 + 5 = 25",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 25,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 25,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 27 (diff: 27) 1`] = `
{
  "fullDecomposition": "0 + 27 = 0 + 20 + 5 + 2 = 27",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 25,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 27,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 27,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 29 (diff: 29) 1`] = `
{
  "fullDecomposition": "0 + 29 = 0 + 20 + 5 + 4 = 29",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 20,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 25,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 3,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29,
      "isValid": true,
      "mathematicalTerm": "4",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 29,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 50 (diff: 50) 1`] = `
{
  "fullDecomposition": "0 + 50 = 0 + 50 = 50",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 50,
      "isValid": true,
      "mathematicalTerm": "50",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 50,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 100 (diff: 100) 1`] = `
{
  "fullDecomposition": "0 + 100 = 0 + 100 = 100",
  "isMeaningfulDecomposition": false,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 0 → 123 (diff: 123) 1`] = `
{
  "fullDecomposition": "0 + 123 = 0 + 100 + 20 + 3 = 123",
  "isMeaningfulDecomposition": true,
  "startValue": 0,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 120,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 123,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 123,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 1 → 5 (diff: 4) 1`] = `
{
  "fullDecomposition": "1 + 4 = 1 + (5 - 1) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 1 → 15 (diff: 14) 1`] = `
{
  "fullDecomposition": "1 + 14 = 1 + 10 + (5 - 1) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 2 → 5 (diff: 3) 1`] = `
{
  "fullDecomposition": "2 + 3 = 2 + (5 - 2) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 7,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 2 → 15 (diff: 13) 1`] = `
{
  "fullDecomposition": "2 + 13 = 2 + 10 + (5 - 2) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 3 → 5 (diff: 2) 1`] = `
{
  "fullDecomposition": "3 + 2 = 3 + (5 - 3) = 5",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 8,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 14,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 5,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 5,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 3 → 15 (diff: 12) 1`] = `
{
  "fullDecomposition": "3 + 12 = 3 + 10 + (5 - 3) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 4 → 15 (diff: 11) 1`] = `
{
  "fullDecomposition": "4 + 11 = 4 + 10 + (5 - 4) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-4",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 5 → 6 (diff: 1) 1`] = `
{
  "fullDecomposition": "5 + 1 = 5 + 1 = 6",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 6,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 13,
        "startIndex": 12,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 6,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 5 → 15 (diff: 10) 1`] = `
{
  "fullDecomposition": "5 + 10 = 5 + 10 = 15",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 5 → 25 (diff: 20) 1`] = `
{
  "fullDecomposition": "5 + 20 = 5 + 20 = 25",
  "isMeaningfulDecomposition": false,
  "startValue": 5,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 25,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 25,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 6 → 10 (diff: 4) 1`] = `
{
  "fullDecomposition": "6 + 4 = 6 + (10 - 6) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 6,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 7 → 10 (diff: 3) 1`] = `
{
  "fullDecomposition": "7 + 3 = 7 + (10 - 7) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 7,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 8 → 10 (diff: 2) 1`] = `
{
  "fullDecomposition": "8 + 2 = 8 + (10 - 8) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 8,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -8",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-8",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 9 → 10 (diff: 1) 1`] = `
{
  "fullDecomposition": "9 + 1 = 9 + (10 - 9) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 12 → 16 (diff: 4) 1`] = `
{
  "fullDecomposition": "12 + 4 = 12 + (5 - 1) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 12,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 13 → 16 (diff: 3) 1`] = `
{
  "fullDecomposition": "13 + 3 = 13 + (5 - 2) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 13,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 14 → 16 (diff: 2) 1`] = `
{
  "fullDecomposition": "14 + 2 = 14 + (5 - 3) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 14,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 16,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 15 → 16 (diff: 1) 1`] = `
{
  "fullDecomposition": "15 + 1 = 15 + 1 = 16",
  "isMeaningfulDecomposition": false,
  "startValue": 15,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "1",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 1,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 50 → 100 (diff: 50) 1`] = `
{
  "fullDecomposition": "50 + 50 = 50 + (100 - 50) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 50,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 150,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-50",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 75 → 100 (diff: 25) 1`] = `
{
  "fullDecomposition": "75 + 25 = 75 + 20 + (100 - 90 - 5) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 75,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 95,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 195,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 105,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-5",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 80 → 100 (diff: 20) 1`] = `
{
  "fullDecomposition": "80 + 20 = 80 + (100 - 80) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 80,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 180,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 3 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-80",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 86 → 100 (diff: 14) 1`] = `
{
  "fullDecomposition": "86 + 14 = 86 + 10 + (100 - 90 - 6) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 86,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 96,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 196,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 106,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 87 → 100 (diff: 13) 1`] = `
{
  "fullDecomposition": "87 + 13 = 87 + 10 + (100 - 90 - 7) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 87,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 97,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 197,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 107,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 88 → 100 (diff: 12) 1`] = `
{
  "fullDecomposition": "88 + 12 = 88 + 10 + (100 - 90 - 8) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 88,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 98,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 198,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 108,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -8",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-8",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 89 → 100 (diff: 11) 1`] = `
{
  "fullDecomposition": "89 + 11 = 89 + 10 + (100 - 90 - 9) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 89,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 99,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 27,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 33,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 90 → 100 (diff: 10) 1`] = `
{
  "fullDecomposition": "90 + 10 = 90 + (100 - 90) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 90,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 190,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 16,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 24,
        "startIndex": 22,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 96 → 100 (diff: 4) 1`] = `
{
  "fullDecomposition": "96 + 4 = 96 + (100 - 90 - 6) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 96,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 196,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 106,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -6",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-6",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 97 → 100 (diff: 3) 1`] = `
{
  "fullDecomposition": "97 + 3 = 97 + (100 - 90 - 7) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 97,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 197,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 107,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 98 → 100 (diff: 2) 1`] = `
{
  "fullDecomposition": "98 + 2 = 98 + (100 - 90 - 8) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 98,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 198,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 108,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -8",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-8",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 99 → 100 (diff: 1) 1`] = `
{
  "fullDecomposition": "99 + 1 = 99 + (100 - 90 - 9) = 100",
  "isMeaningfulDecomposition": true,
  "startValue": 99,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 199,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 109,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "perform operation: -9",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 100,
      "isValid": true,
      "mathematicalTerm": "-9",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 100,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 100 → 223 (diff: 123) 1`] = `
{
  "fullDecomposition": "100 + 123 = 100 + 100 + 20 + 3 = 223",
  "isMeaningfulDecomposition": true,
  "startValue": 100,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 220,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 2,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 223,
      "isValid": true,
      "mathematicalTerm": "3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 30,
        "startIndex": 29,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 223,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 180 → 205 (diff: 25) 1`] = `
{
  "fullDecomposition": "180 + 25 = 180 + (100 - 80) + 5 = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 180,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 280,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 3 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "-80",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 185 → 205 (diff: 20) 1`] = `
{
  "fullDecomposition": "185 + 20 = 185 + (100 - 80) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 185,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 285,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 3 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-80",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 191 → 205 (diff: 14) 1`] = `
{
  "fullDecomposition": "191 + 14 = 191 + (100 - 90) + (5 - 1) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 191,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 291,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 201,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 206,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 192 → 205 (diff: 13) 1`] = `
{
  "fullDecomposition": "192 + 13 = 192 + (100 - 90) + (5 - 2) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 192,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 292,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 202,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 207,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-2",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 193 → 205 (diff: 12) 1`] = `
{
  "fullDecomposition": "193 + 12 = 193 + (100 - 90) + (5 - 3) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 193,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 293,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 203,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 208,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 194 → 205 (diff: 11) 1`] = `
{
  "fullDecomposition": "194 + 11 = 194 + (100 - 90) + (5 - 4) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 194,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 294,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 204,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 5",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 209,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 32,
        "startIndex": 31,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "remove 4 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-4",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 35,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 4,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 195 → 205 (diff: 10) 1`] = `
{
  "fullDecomposition": "195 + 10 = 195 + (100 - 90) = 205",
  "isMeaningfulDecomposition": true,
  "startValue": 195,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 295,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 205,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 205,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 877 → 1000 (diff: 123) 1`] = `
{
  "fullDecomposition": "877 + 123 = 877 + 100 + 20 + (1000 - 900 - 90 - 7) = 1000",
  "isMeaningfulDecomposition": true,
  "startValue": 877,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 977,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 997,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 26,
        "startIndex": 24,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1997,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 34,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1097,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 40,
        "startIndex": 37,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1007,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 45,
        "startIndex": 43,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 49,
        "startIndex": 48,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 900 → 1000 (diff: 100) 1`] = `
{
  "fullDecomposition": "900 + 100 = 900 + (1000 - 900) = 1000",
  "isMeaningfulDecomposition": true,
  "startValue": 900,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1900,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1000,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1000,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Systematic Coverage by Difference > should handle systematic case: 1877 → 2000 (diff: 123) 1`] = `
{
  "fullDecomposition": "1877 + 123 = 1877 + 100 + 20 + (1000 - 900 - 90 - 7) = 2000",
  "isMeaningfulDecomposition": true,
  "startValue": 1877,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1977,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1997,
      "isValid": true,
      "mathematicalTerm": "20",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 28,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 3,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "add 1 to thousands",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2997,
      "isValid": true,
      "mathematicalTerm": "1000",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 36,
        "startIndex": 32,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 3,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 3,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in hundreds column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2097,
      "isValid": true,
      "mathematicalTerm": "-900",
      "stepIndex": 3,
      "termPosition": {
        "endIndex": 42,
        "startIndex": 39,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 4,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 4,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2007,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 4,
      "termPosition": {
        "endIndex": 47,
        "startIndex": 45,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 5,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 5,
        },
      ],
      "englishInstruction": "perform operation: -7",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2000,
      "isValid": true,
      "mathematicalTerm": "-7",
      "stepIndex": 5,
      "termPosition": {
        "endIndex": 51,
        "startIndex": 50,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2000,
  "totalSteps": 6,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 1 → 10 1`] = `
{
  "fullDecomposition": "1 + 9 = 1 + (10 - 1) = 10",
  "isMeaningfulDecomposition": true,
  "startValue": 1,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 10,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 10,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 2 → 11 1`] = `
{
  "fullDecomposition": "2 + 9 = 2 + (10 - 1) = 11",
  "isMeaningfulDecomposition": true,
  "startValue": 2,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 3 → 12 1`] = `
{
  "fullDecomposition": "3 + 9 = 3 + (10 - 1) = 12",
  "isMeaningfulDecomposition": true,
  "startValue": 3,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 12,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 12,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 4 → 11 1`] = `
{
  "fullDecomposition": "4 + 7 = 4 + (10 - 3) = 11",
  "isMeaningfulDecomposition": true,
  "startValue": 4,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 11,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 11,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 6 → 13 1`] = `
{
  "fullDecomposition": "6 + 7 = 6 + (10 - 3) = 13",
  "isMeaningfulDecomposition": true,
  "startValue": 6,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 13,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 13,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 7 → 14 1`] = `
{
  "fullDecomposition": "7 + 7 = 7 + (10 - 3) = 14",
  "isMeaningfulDecomposition": true,
  "startValue": 7,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 14,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 14,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 7 → 16 1`] = `
{
  "fullDecomposition": "7 + 9 = 7 + (10 - 1) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 7,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 8 → 15 1`] = `
{
  "fullDecomposition": "8 + 7 = 8 + (10 - 3) = 15",
  "isMeaningfulDecomposition": true,
  "startValue": 8,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 15,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 15,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 8 → 17 1`] = `
{
  "fullDecomposition": "8 + 9 = 8 + (10 - 1) = 17",
  "isMeaningfulDecomposition": true,
  "startValue": 8,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 18,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 1 earth bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 17,
      "isValid": true,
      "mathematicalTerm": "-1",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 17,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 9 → 16 1`] = `
{
  "fullDecomposition": "9 + 7 = 9 + (10 - 3) = 16",
  "isMeaningfulDecomposition": true,
  "startValue": 9,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 19,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 13,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 16,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 16,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 19 → 26 1`] = `
{
  "fullDecomposition": "19 + 7 = 19 + (10 - 3) = 26",
  "isMeaningfulDecomposition": true,
  "startValue": 19,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 29,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 26,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 26,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 28 → 35 1`] = `
{
  "fullDecomposition": "28 + 7 = 28 + (10 - 3) = 35",
  "isMeaningfulDecomposition": true,
  "startValue": 28,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 38,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 35,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 35,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 37 → 44 1`] = `
{
  "fullDecomposition": "37 + 7 = 37 + (10 - 3) = 44",
  "isMeaningfulDecomposition": true,
  "startValue": 37,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 47,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 44,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 44,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 46 → 53 1`] = `
{
  "fullDecomposition": "46 + 7 = 46 + (10 - 3) = 53",
  "isMeaningfulDecomposition": true,
  "startValue": 46,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 56,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 53,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 53,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 55 → 62 1`] = `
{
  "fullDecomposition": "55 + 7 = 55 + (10 - 3) = 62",
  "isMeaningfulDecomposition": true,
  "startValue": 55,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 65,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 62,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 62,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 64 → 71 1`] = `
{
  "fullDecomposition": "64 + 7 = 64 + (10 - 3) = 71",
  "isMeaningfulDecomposition": true,
  "startValue": 64,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 74,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 71,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 71,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 73 → 80 1`] = `
{
  "fullDecomposition": "73 + 7 = 73 + (10 - 3) = 80",
  "isMeaningfulDecomposition": true,
  "startValue": 73,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to tens",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 83,
      "isValid": true,
      "mathematicalTerm": "10",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 17,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 80,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 21,
        "startIndex": 20,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 80,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 82 → 89 1`] = `
{
  "fullDecomposition": "82 + 7 = 82 + 5 + 2 = 89",
  "isMeaningfulDecomposition": false,
  "startValue": 82,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 87,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 89,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 89,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 91 → 98 1`] = `
{
  "fullDecomposition": "91 + 7 = 91 + 5 + 2 = 98",
  "isMeaningfulDecomposition": false,
  "startValue": 91,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "activate heaven bead",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 96,
      "isValid": true,
      "mathematicalTerm": "5",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 15,
        "startIndex": 14,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "add 2 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 98,
      "isValid": true,
      "mathematicalTerm": "2",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 19,
        "startIndex": 18,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 98,
  "totalSteps": 2,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 94 → 101 1`] = `
{
  "fullDecomposition": "94 + 7 = 94 + (100 - 90 - 3) = 101",
  "isMeaningfulDecomposition": true,
  "startValue": 94,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 194,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 18,
        "startIndex": 15,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 104,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 23,
        "startIndex": 21,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 101,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 26,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 101,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 193 → 200 1`] = `
{
  "fullDecomposition": "193 + 7 = 193 + (100 - 90 - 3) = 200",
  "isMeaningfulDecomposition": true,
  "startValue": 193,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 293,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 203,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 200,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 200,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 294 → 301 1`] = `
{
  "fullDecomposition": "294 + 7 = 294 + (100 - 90 - 3) = 301",
  "isMeaningfulDecomposition": true,
  "startValue": 294,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 394,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 304,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 301,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 301,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 395 → 402 1`] = `
{
  "fullDecomposition": "395 + 7 = 395 + (100 - 90 - 3) = 402",
  "isMeaningfulDecomposition": true,
  "startValue": 395,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 495,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 405,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 402,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 402,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 496 → 503 1`] = `
{
  "fullDecomposition": "496 + 7 = 496 + (100 - 90 - 3) = 503",
  "isMeaningfulDecomposition": true,
  "startValue": 496,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 596,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 506,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 503,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 503,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 597 → 604 1`] = `
{
  "fullDecomposition": "597 + 7 = 597 + (100 - 90 - 3) = 604",
  "isMeaningfulDecomposition": true,
  "startValue": 597,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 604,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 604,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 698 → 705 1`] = `
{
  "fullDecomposition": "698 + 7 = 698 + (100 - 90 - 3) = 705",
  "isMeaningfulDecomposition": true,
  "startValue": 698,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 798,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 708,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 705,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 705,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 799 → 806 1`] = `
{
  "fullDecomposition": "799 + 7 = 799 + (100 - 90 - 3) = 806",
  "isMeaningfulDecomposition": true,
  "startValue": 799,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 899,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 20,
        "startIndex": 17,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 809,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 25,
        "startIndex": 23,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 806,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 29,
        "startIndex": 28,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 806,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 1294 → 1301 1`] = `
{
  "fullDecomposition": "1294 + 7 = 1294 + (100 - 90 - 3) = 1301",
  "isMeaningfulDecomposition": true,
  "startValue": 1294,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1394,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1304,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 1,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 1301,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 1301,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 2395 → 2402 1`] = `
{
  "fullDecomposition": "2395 + 7 = 2395 + (100 - 90 - 3) = 2402",
  "isMeaningfulDecomposition": true,
  "startValue": 2395,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2495,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2405,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 0,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "3": {
          "earthActive": 2,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 2402,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 2402,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 3496 → 3503 1`] = `
{
  "fullDecomposition": "3496 + 7 = 3496 + (100 - 90 - 3) = 3503",
  "isMeaningfulDecomposition": true,
  "startValue": 3496,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 2,
          "position": 3,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 2,
          "position": 2,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 2,
          "position": 1,
          "stepIndex": 0,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3596,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3506,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 1,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 0,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 3,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 3503,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 3503,
  "totalSteps": 3,
}
`;

exports[`Pedagogical Algorithm Snapshot Tests > Ten-Complement Cases > should handle ten-complement: 4597 → 4604 1`] = `
{
  "fullDecomposition": "4597 + 7 = 4597 + (100 - 90 - 3) = 4604",
  "isMeaningfulDecomposition": true,
  "startValue": 4597,
  "steps": [
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 2,
          "position": 0,
          "stepIndex": 0,
        },
      ],
      "englishInstruction": "add 1 to hundreds",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 4,
          "heavenActive": true,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4697,
      "isValid": true,
      "mathematicalTerm": "100",
      "stepIndex": 0,
      "termPosition": {
        "endIndex": 22,
        "startIndex": 19,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 0,
          "placeValue": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 1,
          "placeValue": 1,
          "position": 3,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 1,
          "position": 2,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 3,
          "placeValue": 1,
          "position": 1,
          "stepIndex": 1,
        },
        {
          "beadType": "earth",
          "direction": "deactivate",
          "order": 4,
          "placeValue": 1,
          "position": 0,
          "stepIndex": 1,
        },
      ],
      "englishInstruction": "deactivate heaven bead and remove 4 earth beads in tens column",
      "expectedState": {
        "0": {
          "earthActive": 2,
          "heavenActive": true,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4607,
      "isValid": true,
      "mathematicalTerm": "-90",
      "stepIndex": 1,
      "termPosition": {
        "endIndex": 27,
        "startIndex": 25,
      },
      "validationIssues": [],
    },
    {
      "beadMovements": [
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 0,
          "placeValue": 0,
          "position": 2,
          "stepIndex": 2,
        },
        {
          "beadType": "earth",
          "direction": "activate",
          "order": 1,
          "placeValue": 0,
          "position": 3,
          "stepIndex": 2,
        },
        {
          "beadType": "heaven",
          "direction": "deactivate",
          "order": 2,
          "placeValue": 0,
          "stepIndex": 2,
        },
      ],
      "englishInstruction": "remove 3 earth beads",
      "expectedState": {
        "0": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "1": {
          "earthActive": 0,
          "heavenActive": false,
        },
        "2": {
          "earthActive": 1,
          "heavenActive": true,
        },
        "3": {
          "earthActive": 4,
          "heavenActive": false,
        },
        "4": {
          "earthActive": 0,
          "heavenActive": false,
        },
      },
      "expectedValue": 4604,
      "isValid": true,
      "mathematicalTerm": "-3",
      "stepIndex": 2,
      "termPosition": {
        "endIndex": 31,
        "startIndex": 30,
      },
      "validationIssues": [],
    },
  ],
  "targetValue": 4604,
  "totalSteps": 3,
}
`;
